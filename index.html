<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>RYD STORE OFFICIAL - V.PRO MASTER</title>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@300;400;500;600;700;800&display=swap');
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap');
        
        :root {
            --primary: #6366f1;
            --primary-dark: #4f46e5;
            --secondary: #8b5cf6;
            --success: #10b981;
            --warning: #f59e0b;
            --danger: #ef4444;
            --dark: #0f172a;
            --light: #f8fafc;
            --card-shadow: 0 10px 25px -5px rgba(0, 0, 0, 0.05), 0 8px 10px -6px rgba(0, 0, 0, 0.01);
            --hover-shadow: 0 20px 40px -10px rgba(0, 0, 0, 0.1);
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Inter', 'Plus Jakarta Sans', sans-serif;
            background: linear-gradient(135deg, #f5f7fa 0%, #e4edf5 100%);
            color: #334155;
            min-height: 100vh;
            overflow-x: hidden;
            -webkit-tap-highlight-color: transparent;
        }
        
        /* Scrollbar Styling */
        ::-webkit-scrollbar {
            width: 6px;
            height: 6px;
        }
        
        ::-webkit-scrollbar-track {
            background: #f1f5f9;
            border-radius: 10px;
        }
        
        ::-webkit-scrollbar-thumb {
            background: linear-gradient(135deg, var(--primary) 0%, var(--secondary) 100%);
            border-radius: 10px;
        }
        
        /* Utility Classes */
        .glass-effect {
            background: rgba(255, 255, 255, 0.85);
            backdrop-filter: blur(12px);
            -webkit-backdrop-filter: blur(12px);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
        
        .neumorphism {
            background: #f0f0f3;
            box-shadow: 10px 10px 30px rgba(174, 174, 192, 0.2), -10px -10px 30px rgba(255, 255, 255, 0.9);
            border-radius: 20px;
        }
        
        .gradient-primary {
            background: linear-gradient(135deg, var(--primary) 0%, var(--secondary) 100%);
        }
        
        .gradient-success {
            background: linear-gradient(135deg, #10b981 0%, #059669 100%);
        }
        
        .gradient-warning {
            background: linear-gradient(135deg, #f59e0b 0%, #d97706 100%);
        }
        
        .gradient-danger {
            background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%);
        }
        
        .card-hover {
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }
        
        .card-hover:hover {
            transform: translateY(-5px);
            box-shadow: var(--hover-shadow);
        }
        
        .btn-primary {
            background: linear-gradient(135deg, var(--primary) 0%, var(--secondary) 100%);
            color: white;
            border: none;
            font-weight: 600;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(99, 102, 241, 0.3);
        }
        
        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(99, 102, 241, 0.4);
        }
        
        .btn-success {
            background: linear-gradient(135deg, #10b981 0%, #059669 100%);
            color: white;
            border: none;
            font-weight: 600;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(16, 185, 129, 0.3);
        }
        
        .btn-success:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(16, 185, 129, 0.4);
        }
        
        /* Main App Container */
        #app {
            max-width: 480px;
            margin: 0 auto;
            min-height: 100vh;
            position: relative;
            background: white;
            box-shadow: 0 0 40px rgba(0, 0, 0, 0.05);
        }
        
        /* Sub Pages */
        .sub-page {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: white;
            z-index: 1000;
            transform: translateX(100%);
            transition: transform 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            overflow-y: auto;
            padding: 20px;
            display: none;
        }
        
        .sub-page.active {
            transform: translateX(0);
            display: block;
        }
        
        /* Modal Styles */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            backdrop-filter: blur(5px);
            z-index: 2000;
            display: none;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }
        
        .modal-content {
            background: white;
            border-radius: 24px;
            width: 100%;
            max-width: 400px;
            max-height: 85vh;
            overflow-y: auto;
            box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.25);
            animation: modalSlideUp 0.3s ease-out;
        }
        
        @keyframes modalSlideUp {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        /* Loading Animation */
        .loading-spinner {
            width: 40px;
            height: 40px;
            border: 3px solid #f3f3f3;
            border-top: 3px solid var(--primary);
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin: 20px auto;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        /* Badge */
        .badge {
            display: inline-flex;
            align-items: center;
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        
        .badge-primary {
            background: linear-gradient(135deg, var(--primary) 0%, var(--secondary) 100%);
            color: white;
        }
        
        .badge-success {
            background: linear-gradient(135deg, #10b981 0%, #059669 100%);
            color: white;
        }
        
        /* Shimmer Effect for Loading */
        .shimmer {
            background: linear-gradient(90deg, #f0f0f0 25%, #e0e0e0 50%, #f0f0f0 75%);
            background-size: 200% 100%;
            animation: shimmer 1.5s infinite;
        }
        
        @keyframes shimmer {
            0% { background-position: -200% 0; }
            100% { background-position: 200% 0; }
        }
        
        /* Pulse Animation */
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.7; }
        }
        
        .pulse {
            animation: pulse 2s infinite;
        }
        
        /* Floating Action Button */
        .fab {
            position: fixed;
            bottom: 30px;
            right: 30px;
            width: 60px;
            height: 60px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
            color: white;
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.2);
            z-index: 100;
            transition: all 0.3s ease;
        }
        
        .fab:hover {
            transform: scale(1.1);
            box-shadow: 0 15px 30px rgba(0, 0, 0, 0.3);
        }
        
        /* Category Icons */
        .category-icon {
            width: 60px;
            height: 60px;
            border-radius: 16px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
            font-weight: 700;
            color: white;
            margin: 0 auto 10px;
            box-shadow: 0 8px 16px rgba(0, 0, 0, 0.15);
            transition: all 0.3s ease;
        }
        
        .category-icon:hover {
            transform: scale(1.05) rotate(5deg);
        }
        
        /* Transaction History Items */
        .transaction-item {
            border-left: 4px solid transparent;
            transition: all 0.3s ease;
        }
        
        .transaction-item:hover {
            border-left-color: var(--primary);
            background: rgba(99, 102, 241, 0.05);
        }
        
        /* Responsive Adjustments */
        @media (max-width: 480px) {
            .sub-page {
                padding: 16px;
            }
            
            .category-icon {
                width: 50px;
                height: 50px;
                font-size: 20px;
            }
            
            .fab {
                width: 50px;
                height: 50px;
                bottom: 20px;
                right: 20px;
                font-size: 20px;
            }
        }
        
        @media (max-width: 360px) {
            .sub-page {
                padding: 12px;
            }
        }
    </style>
</head>
<body>

<!-- Main App Container -->
<div id="app" class="max-w-md mx-auto min-h-screen relative pb-32"></div>

<!-- Modal Produk -->
<div id="modalProduk" class="modal-overlay" onclick="tutupModal()">
    <div class="modal-content p-6" onclick="event.stopPropagation()">
        <div class="flex justify-between items-center mb-6">
            <h3 id="modalTitle" class="text-lg font-bold text-gray-800">Pilih Item</h3>
            <button onclick="tutupModal()" class="text-gray-400 hover:text-gray-600 text-2xl">&times;</button>
        </div>
        
        <div class="mb-5">
            <label class="block text-sm font-semibold text-gray-600 mb-2">Tujuan / ID Player</label>
            <input id="inputTujuan" type="text" placeholder="Contoh: 08123456789 atau 12345678" 
                   class="w-full p-4 bg-gray-50 rounded-xl border border-gray-200 focus:border-blue-500 focus:ring-2 focus:ring-blue-200 outline-none transition-all font-medium">
        </div>
        
        <div id="listProduk" class="grid grid-cols-2 gap-3 max-h-[50vh] overflow-y-auto pb-4"></div>
        
        <div class="mt-6 pt-4 border-t border-gray-100">
            <p class="text-xs text-gray-500 text-center">Pastikan data tujuan sudah benar sebelum membeli</p>
        </div>
    </div>
</div>

<!-- Modal Transfer -->
<div id="modalTransfer" class="modal-overlay" onclick="tutupModalTransfer()">
    <div class="modal-content p-6" onclick="event.stopPropagation()">
        <div class="flex justify-between items-center mb-6">
            <h3 class="text-lg font-bold text-gray-800">Transfer Saldo</h3>
            <button onclick="tutupModalTransfer()" class="text-gray-400 hover:text-gray-600 text-2xl">&times;</button>
        </div>
        
        <div class="space-y-4">
            <div>
                <label class="block text-sm font-semibold text-gray-600 mb-2">Username Tujuan</label>
                <input id="tfUsername" type="text" placeholder="Masukkan username penerima" 
                       class="w-full p-4 bg-gray-50 rounded-xl border border-gray-200 focus:border-blue-500 focus:ring-2 focus:ring-blue-200 outline-none transition-all font-medium">
            </div>
            
            <div>
                <label class="block text-sm font-semibold text-gray-600 mb-2">Jumlah Transfer</label>
                <div class="relative">
                    <span class="absolute left-4 top-1/2 transform -translate-y-1/2 text-gray-500 font-bold">Rp</span>
                    <input id="tfAmount" type="number" placeholder="0" 
                           class="w-full p-4 pl-12 bg-gray-50 rounded-xl border border-gray-200 focus:border-blue-500 focus:ring-2 focus:ring-blue-200 outline-none transition-all font-medium text-lg">
                </div>
                <p class="text-xs text-gray-500 mt-2">Saldo Anda: <span id="saldoTransfer" class="font-bold">Rp 0</span></p>
            </div>
            
            <button onclick="prosesTransfer()" class="w-full btn-success p-4 rounded-xl font-bold text-lg mt-6">
                Transfer Sekarang
            </button>
        </div>
    </div>
</div>

<!-- Modal Top Up -->
<div id="modalTopUp" class="modal-overlay" onclick="tutupModalTopUp()">
    <div class="modal-content p-6" onclick="event.stopPropagation()">
        <div class="flex justify-between items-center mb-6">
            <h3 class="text-lg font-bold text-gray-800">Top Up Saldo</h3>
            <button onclick="tutupModalTopUp()" class="text-gray-400 hover:text-gray-600 text-2xl">&times;</button>
        </div>
        
        <div class="space-y-4">
            <div>
                <label class="block text-sm font-semibold text-gray-600 mb-2">Jumlah Top Up</label>
                <div class="relative">
                    <span class="absolute left-4 top-1/2 transform -translate-y-1/2 text-gray-500 font-bold">Rp</span>
                    <input id="topupAmount" type="number" placeholder="Minimal Rp 10.000" 
                           class="w-full p-4 pl-12 bg-gray-50 rounded-xl border border-gray-200 focus:border-blue-500 focus:ring-2 focus:ring-blue-200 outline-none transition-all font-medium text-lg">
                </div>
                <p class="text-xs text-gray-500 mt-2">Saldo akan bertambah setelah pembayaran dikonfirmasi</p>
            </div>
            
            <div class="grid grid-cols-3 gap-2 mt-4">
                <button onclick="setTopUpAmount(10000)" class="p-3 bg-blue-50 text-blue-600 rounded-lg font-medium hover:bg-blue-100 transition-all">10K</button>
                <button onclick="setTopUpAmount(50000)" class="p-3 bg-blue-50 text-blue-600 rounded-lg font-medium hover:bg-blue-100 transition-all">50K</button>
                <button onclick="setTopUpAmount(100000)" class="p-3 bg-blue-50 text-blue-600 rounded-lg font-medium hover:bg-blue-100 transition-all">100K</button>
                <button onclick="setTopUpAmount(200000)" class="p-3 bg-blue-50 text-blue-600 rounded-lg font-medium hover:bg-blue-100 transition-all">200K</button>
                <button onclick="setTopUpAmount(500000)" class="p-3 bg-blue-50 text-blue-600 rounded-lg font-medium hover:bg-blue-100 transition-all">500K</button>
                <button onclick="setTopUpAmount(1000000)" class="p-3 bg-blue-50 text-blue-600 rounded-lg font-medium hover:bg-blue-100 transition-all">1 JT</button>
            </div>
            
            <button onclick="prosesTopUp()" class="w-full btn-primary p-4 rounded-xl font-bold text-lg mt-6">
                Lanjutkan ke WhatsApp
            </button>
        </div>
    </div>
</div>

<!-- Sub Pages -->
<div id="pageEwallet" class="sub-page max-w-md mx-auto">
    <div class="sticky top-0 glass-effect z-10 p-4 rounded-b-3xl mb-6">
        <div class="flex items-center gap-4">
            <button onclick="closeSubPage('pageEwallet')" class="w-10 h-10 bg-white shadow-md rounded-xl flex items-center justify-center font-bold text-gray-700 hover:bg-gray-50 transition-all">
                ‚Üê
            </button>
            <div>
                <h2 class="text-xl font-bold text-gray-800">E-Wallet & Dompet Digital</h2>
                <p class="text-xs text-gray-500">Isi saldo e-wallet favorit Anda</p>
            </div>
        </div>
    </div>
    
    <div class="grid grid-cols-2 gap-4 px-2">
        <div onclick="bukaModal('DANA', 'E-Wallet', 'bg-blue-500', 'D')" class="card-hover card-white p-6 flex flex-col items-center cursor-pointer">
            <div class="category-icon bg-gradient-to-br from-blue-500 to-blue-600">D</div>
            <span class="font-bold text-gray-800 mt-2">DANA</span>
            <p class="text-xs text-gray-500 text-center mt-1">Mulai Rp 5.000</p>
        </div>
        <div onclick="bukaModal('OVO', 'E-Wallet', 'bg-purple-600', 'O')" class="card-hover card-white p-6 flex flex-col items-center cursor-pointer">
            <div class="category-icon bg-gradient-to-br from-purple-600 to-purple-700">O</div>
            <span class="font-bold text-gray-800 mt-2">OVO</span>
            <p class="text-xs text-gray-500 text-center mt-1">Mulai Rp 5.000</p>
        </div>
        <div onclick="bukaModal('GOPAY', 'E-Wallet', 'bg-green-500', 'G')" class="card-hover card-white p-6 flex flex-col items-center cursor-pointer">
            <div class="category-icon bg-gradient-to-br from-green-500 to-green-600">G</div>
            <span class="font-bold text-gray-800 mt-2">GOPAY</span>
            <p class="text-xs text-gray-500 text-center mt-1">Mulai Rp 5.000</p>
        </div>
        <div onclick="bukaModal('ShopeePay', 'E-Wallet', 'bg-orange-500', 'S')" class="card-hover card-white p-6 flex flex-col items-center cursor-pointer">
            <div class="category-icon bg-gradient-to-br from-orange-500 to-orange-600">S</div>
            <span class="font-bold text-gray-800 mt-2">ShopeePay</span>
            <p class="text-xs text-gray-500 text-center mt-1">Mulai Rp 5.000</p>
        </div>
        <div onclick="bukaModal('LinkAja', 'E-Wallet', 'bg-red-500', 'L')" class="card-hover card-white p-6 flex flex-col items-center cursor-pointer">
            <div class="category-icon bg-gradient-to-br from-red-500 to-red-600">L</div>
            <span class="font-bold text-gray-800 mt-2">LinkAja</span>
            <p class="text-xs text-gray-500 text-center mt-1">Mulai Rp 5.000</p>
        </div>
        <div onclick="bukaModal('Jenius', 'E-Wallet', 'bg-pink-500', 'J')" class="card-hover card-white p-6 flex flex-col items-center cursor-pointer">
            <div class="category-icon bg-gradient-to-br from-pink-500 to-pink-600">J</div>
            <span class="font-bold text-gray-800 mt-2">Jenius</span>
            <p class="text-xs text-gray-500 text-center mt-1">Mulai Rp 5.000</p>
        </div>
    </div>
    
    <div class="mt-8 px-2">
        <div class="bg-gradient-to-r from-blue-50 to-indigo-50 border border-blue-100 rounded-2xl p-4">
            <h4 class="font-bold text-gray-800 text-sm mb-2">üí° Tips Pembelian</h4>
            <p class="text-xs text-gray-600">Pastikan nomor tujuan sudah benar sebelum melakukan pembelian. Transaksi yang sudah berhasil tidak dapat dibatalkan.</p>
        </div>
    </div>
</div>

<div id="pageGame" class="sub-page max-w-md mx-auto">
    <div class="sticky top-0 glass-effect z-10 p-4 rounded-b-3xl mb-6">
        <div class="flex items-center gap-4">
            <button onclick="closeSubPage('pageGame')" class="w-10 h-10 bg-white shadow-md rounded-xl flex items-center justify-center font-bold text-gray-700 hover:bg-gray-50 transition-all">
                ‚Üê
            </button>
            <div>
                <h2 class="text-xl font-bold text-gray-800">Top Up Game</h2>
                <p class="text-xs text-gray-500">Diamond, UC, Voucher & Koin Game</p>
            </div>
        </div>
    </div>
    
    <div class="grid grid-cols-3 gap-4 px-2">
        <div onclick="bukaModal('Mobile Legends', 'Diamond', 'bg-gradient-to-br from-orange-500 to-red-600', 'ML')" class="card-hover flex flex-col items-center cursor-pointer">
            <div class="category-icon bg-gradient-to-br from-orange-500 to-red-600">ML</div>
            <span class="text-xs font-bold text-gray-800 text-center">Mobile Legends</span>
        </div>
        <div onclick="bukaModal('Free Fire', 'Diamond', 'bg-gradient-to-br from-amber-600 to-amber-700', 'FF')" class="card-hover flex flex-col items-center cursor-pointer">
            <div class="category-icon bg-gradient-to-br from-amber-600 to-amber-700">FF</div>
            <span class="text-xs font-bold text-gray-800 text-center">Free Fire</span>
        </div>
        <div onclick="bukaModal('PUBG Mobile', 'UC', 'bg-gradient-to-br from-gray-700 to-gray-900', 'PUBG')" class="card-hover flex flex-col items-center cursor-pointer">
            <div class="category-icon bg-gradient-to-br from-gray-700 to-gray-900">PB</div>
            <span class="text-xs font-bold text-gray-800 text-center">PUBG Mobile</span>
        </div>
        <div onclick="bukaModal('Royal Dream', 'B', 'bg-gradient-to-br from-purple-600 to-indigo-700', 'RD')" class="card-hover flex flex-col items-center cursor-pointer">
            <div class="category-icon bg-gradient-to-br from-purple-600 to-indigo-700">RD</div>
            <span class="text-xs font-bold text-gray-800 text-center">Royal Dream</span>
        </div>
        <div onclick="bukaModal('Higgs Domino', 'Koin', 'bg-gradient-to-br from-pink-600 to-rose-700', 'HD')" class="card-hover flex flex-col items-center cursor-pointer">
            <div class="category-icon bg-gradient-to-br from-pink-600 to-rose-700">HD</div>
            <span class="text-xs font-bold text-gray-800 text-center">Higgs Domino</span>
        </div>
        <div onclick="bukaModal('AOV', 'Voucher', 'bg-gradient-to-br from-cyan-500 to-blue-600', 'AOV')" class="card-hover flex flex-col items-center cursor-pointer">
            <div class="category-icon bg-gradient-to-br from-cyan-500 to-blue-600">AV</div>
            <span class="text-xs font-bold text-gray-800 text-center">Arena of Valor</span>
        </div>
        <div onclick="bukaModal('COD Mobile', 'CP', 'bg-gradient-to-br from-gray-800 to-black', 'CODM')" class="card-hover flex flex-col items-center cursor-pointer">
            <div class="category-icon bg-gradient-to-br from-gray-800 to-black">CO</div>
            <span class="text-xs font-bold text-gray-800 text-center">CODM</span>
        </div>
        <div onclick="bukaModal('Valorant', 'Points', 'bg-gradient-to-br from-red-500 to-red-700', 'VAL')" class="card-hover flex flex-col items-center cursor-pointer">
            <div class="category-icon bg-gradient-to-br from-red-500 to-red-700">V</div>
            <span class="text-xs font-bold text-gray-800 text-center">Valorant</span>
        </div>
        <div onclick="bukaModal('Genshin Impact', 'Crystals', 'bg-gradient-to-br from-blue-400 to-teal-500', 'GI')" class="card-hover flex flex-col items-center cursor-pointer">
            <div class="category-icon bg-gradient-to-br from-blue-400 to-teal-500">GI</div>
            <span class="text-xs font-bold text-gray-800 text-center">Genshin Impact</span>
        </div>
    </div>
    
    <div class="mt-8 px-2">
        <div class="bg-gradient-to-r from-amber-50 to-orange-50 border border-amber-100 rounded-2xl p-4">
            <h4 class="font-bold text-gray-800 text-sm mb-2">üéÆ Game Lainnya</h4>
            <p class="text-xs text-gray-600">Game tidak tersedia? Hubungi admin untuk request game yang ingin Anda top up.</p>
        </div>
    </div>
</div>

<div id="pageInvite" class="sub-page max-w-md mx-auto">
    <div class="sticky top-0 glass-effect z-10 p-4 rounded-b-3xl mb-6">
        <div class="flex items-center gap-4">
            <button onclick="closeSubPage('pageInvite')" class="w-10 h-10 bg-white shadow-md rounded-xl flex items-center justify-center font-bold text-gray-700 hover:bg-gray-50 transition-all">
                ‚Üê
            </button>
            <div>
                <h2 class="text-xl font-bold text-gray-800">Program Referral</h2>
                <p class="text-xs text-gray-500">Dapatkan bonus saldo melimpah</p>
            </div>
        </div>
    </div>
    
    <div class="px-2">
        <div class="bg-gradient-to-br from-blue-500 to-purple-600 rounded-3xl p-6 text-white text-center mb-8 shadow-lg">
            <div class="w-20 h-20 bg-white/20 rounded-full flex items-center justify-center mx-auto mb-4">
                <span class="text-3xl">üéÅ</span>
            </div>
            <h3 class="text-xl font-bold mb-2">Dapatkan Bonus 10%</h3>
            <p class="text-sm opacity-90">Dari setiap top up teman yang Anda undang</p>
        </div>
        
        <div class="space-y-6">
            <div class="card-white p-5">
                <h4 class="font-bold text-gray-800 text-sm mb-4 flex items-center gap-2">
                    <span class="w-6 h-6 bg-blue-100 text-blue-600 rounded-full flex items-center justify-center text-xs">1</span>
                    Salin Kode Referral
                </h4>
                <div class="p-4 bg-gray-50 rounded-xl border border-gray-200">
                    <p class="text-[10px] font-bold text-gray-400 uppercase mb-1">Kode Referral Anda</p>
                    <div class="flex items-center justify-between">
                        <h3 id="refCode" class="text-2xl font-bold text-gray-800 tracking-wider">LOADING...</h3>
                        <button onclick="salinRef()" class="btn-primary px-4 py-2 rounded-lg text-sm font-bold">
                            Salin
                        </button>
                    </div>
                </div>
            </div>
            
            <div class="card-white p-5">
                <h4 class="font-bold text-gray-800 text-sm mb-4 flex items-center gap-2">
                    <span class="w-6 h-6 bg-blue-100 text-blue-600 rounded-full flex items-center justify-center text-xs">2</span>
                    Bagikan Ke Teman
                </h4>
                <p class="text-sm text-gray-600 mb-4">Bagikan kode referral Anda ke teman dan ajak mereka bergabung di RYD STORE.</p>
                <div class="grid grid-cols-2 gap-3">
                    <button onclick="shareToWhatsApp()" class="p-3 bg-green-50 text-green-600 rounded-lg font-medium flex items-center justify-center gap-2">
                        <span>üì±</span> WhatsApp
                    </button>
                    <button onclick="shareToTelegram()" class="p-3 bg-blue-50 text-blue-600 rounded-lg font-medium flex items-center justify-center gap-2">
                        <span>‚úàÔ∏è</span> Telegram
                    </button>
                </div>
            </div>
            
            <div class="card-white p-5">
                <h4 class="font-bold text-gray-800 text-sm mb-4 flex items-center gap-2">
                    <span class="w-6 h-6 bg-blue-100 text-blue-600 rounded-full flex items-center justify-center text-xs">3</span>
                    Dapatkan Komisi
                </h4>
                <p class="text-sm text-gray-600">Anda akan mendapatkan komisi 10% dari setiap top up yang dilakukan oleh teman yang Anda undang.</p>
                <div class="mt-4 p-3 bg-gradient-to-r from-green-50 to-emerald-50 border border-green-200 rounded-xl">
                    <p class="text-xs font-bold text-gray-600">Contoh: Jika teman top up Rp 100.000, Anda dapat Rp 10.000!</p>
                </div>
            </div>
        </div>
    </div>
</div>

<div id="pageProfile" class="sub-page max-w-md mx-auto">
    <div class="sticky top-0 glass-effect z-10 p-4 rounded-b-3xl mb-6">
        <div class="flex items-center gap-4">
            <button onclick="closeSubPage('pageProfile')" class="w-10 h-10 bg-white shadow-md rounded-xl flex items-center justify-center font-bold text-gray-700 hover:bg-gray-50 transition-all">
                ‚Üê
            </button>
            <div>
                <h2 class="text-xl font-bold text-gray-800">Profil Saya</h2>
                <p class="text-xs text-gray-500">Kelola akun dan data pribadi</p>
            </div>
        </div>
    </div>
    
    <div class="px-2">
        <div class="flex flex-col items-center mb-8">
            <div class="relative mb-6">
                <img id="my_photo" src="https://cdn-icons-png.flaticon.com/512/149/149071.png" 
                     class="w-28 h-28 rounded-2xl object-cover border-4 border-white shadow-lg">
                <label for="up_foto" class="absolute -bottom-2 -right-2 bg-gradient-to-br from-blue-500 to-purple-600 p-3 rounded-full text-white cursor-pointer shadow-lg border-4 border-white">
                    üì∑
                </label>
                <input type="file" id="up_foto" class="hidden" accept="image/*" onchange="prosesFoto()">
            </div>
            <h3 id="my_display_name" class="text-xl font-bold text-gray-800">@USERNAME</h3>
            <p id="my_member_since" class="text-sm text-gray-500 mt-1">Member sejak: Loading...</p>
        </div>
        
        <div class="space-y-5">
            <div class="card-white p-5">
                <h4 class="font-bold text-gray-800 text-sm mb-4">Informasi Pribadi</h4>
                <div class="space-y-4">
                    <div>
                        <label class="block text-xs font-semibold text-gray-500 mb-2">Nama Lengkap</label>
                        <input id="up_nama" type="text" placeholder="Masukkan nama lengkap" 
                               class="w-full p-4 bg-gray-50 rounded-xl border border-gray-200 focus:border-blue-500 focus:ring-2 focus:ring-blue-200 outline-none transition-all font-medium">
                    </div>
                    <div>
                        <label class="block text-xs font-semibold text-gray-500 mb-2">Nomor WhatsApp</label>
                        <input id="up_wa" type="number" placeholder="Contoh: 628123456789" 
                               class="w-full p-4 bg-gray-50 rounded-xl border border-gray-200 focus:border-blue-500 focus:ring-2 focus:ring-blue-200 outline-none transition-all font-medium">
                    </div>
                </div>
            </div>
            
            <div class="card-white p-5">
                <h4 class="font-bold text-gray-800 text-sm mb-4">Informasi Akun</h4>
                <div class="space-y-3">
                    <div class="flex justify-between items-center py-3 border-b border-gray-100">
                        <span class="text-sm text-gray-600">Username</span>
                        <span id="info_username" class="font-bold text-gray-800">@username</span>
                    </div>
                    <div class="flex justify-between items-center py-3 border-b border-gray-100">
                        <span class="text-sm text-gray-600">Kode Referral</span>
                        <span id="info_refcode" class="font-bold text-blue-600">RYD123</span>
                    </div>
                    <div class="flex justify-between items-center py-3">
                        <span class="text-sm text-gray-600">Total Transaksi</span>
                        <span id="info_transaksi" class="font-bold text-gray-800">0</span>
                    </div>
                </div>
            </div>
            
            <button onclick="saveDataProfil()" class="w-full btn-primary p-4 rounded-xl font-bold text-lg">
                Simpan Perubahan
            </button>
            
            <button onclick="konfirmasiLogout()" class="w-full p-4 text-red-500 font-bold border border-red-200 rounded-xl hover:bg-red-50 transition-all">
                Keluar Akun
            </button>
        </div>
    </div>
</div>

<div id="pageBank" class="sub-page max-w-md mx-auto">
    <div class="sticky top-0 glass-effect z-10 p-4 rounded-b-3xl mb-6">
        <div class="flex items-center gap-4">
            <button onclick="closeSubPage('pageBank')" class="w-10 h-10 bg-white shadow-md rounded-xl flex items-center justify-center font-bold text-gray-700 hover:bg-gray-50 transition-all">
                ‚Üê
            </button>
            <div>
                <h2 class="text-xl font-bold text-gray-800">Transfer Bank</h2>
                <p class="text-xs text-gray-500">Pilih bank tujuan transfer</p>
            </div>
        </div>
    </div>
    
    <div class="px-2">
        <div class="relative mb-6">
            <input type="text" id="searchBank" onkeyup="filterBank()" placeholder="Cari nama bank..." 
                   class="w-full p-4 pl-12 bg-white rounded-xl border border-gray-200 focus:border-blue-500 focus:ring-2 focus:ring-blue-200 outline-none transition-all font-medium shadow-sm">
            <span class="absolute left-4 top-1/2 transform -translate-y-1/2 text-gray-400">üîç</span>
        </div>
        
        <div id="listBank" class="grid grid-cols-2 gap-4 pb-20">
            <!-- Daftar bank akan dimuat di sini -->
        </div>
    </div>
</div>

<div id="pagePulsa" class="sub-page max-w-md mx-auto">
    <div class="sticky top-0 glass-effect z-10 p-4 rounded-b-3xl mb-6">
        <div class="flex items-center gap-4">
            <button onclick="closeSubPage('pagePulsa')" class="w-10 h-10 bg-white shadow-md rounded-xl flex items-center justify-center font-bold text-gray-700 hover:bg-gray-50 transition-all">
                ‚Üê
            </button>
            <div>
                <h2 class="text-xl font-bold text-gray-800">Pulsa & Paket Data</h2>
                <p class="text-xs text-gray-500">Isi pulsa dan paket internet</p>
            </div>
        </div>
    </div>
    
    <div class="grid grid-cols-3 gap-4 px-2">
        <div onclick="bukaModal('Telkomsel', 'Pulsa', 'bg-gradient-to-br from-red-500 to-red-600', 'TS')" class="card-hover flex flex-col items-center cursor-pointer">
            <div class="category-icon bg-gradient-to-br from-red-500 to-red-600">TS</div>
            <span class="text-xs font-bold text-gray-800 text-center">Telkomsel</span>
            <p class="text-[10px] text-gray-500 text-center">Pulsa & Paket</p>
        </div>
        <div onclick="bukaModal('Indosat', 'Pulsa', 'bg-gradient-to-br from-yellow-500 to-yellow-600', 'IS')" class="card-hover flex flex-col items-center cursor-pointer">
            <div class="category-icon bg-gradient-to-br from-yellow-500 to-yellow-600">IS</div>
            <span class="text-xs font-bold text-gray-800 text-center">Indosat</span>
            <p class="text-[10px] text-gray-500 text-center">Pulsa & Paket</p>
        </div>
        <div onclick="bukaModal('XL', 'Pulsa', 'bg-gradient-to-br from-blue-500 to-blue-600', 'XL')" class="card-hover flex flex-col items-center cursor-pointer">
            <div class="category-icon bg-gradient-to-br from-blue-500 to-blue-600">XL</div>
            <span class="text-xs font-bold text-gray-800 text-center">XL Axiata</span>
            <p class="text-[10px] text-gray-500 text-center">Pulsa & Paket</p>
        </div>
        <div onclick="bukaModal('Axis', 'Pulsa', 'bg-gradient-to-br from-purple-500 to-purple-600', 'AX')" class="card-hover flex flex-col items-center cursor-pointer">
            <div class="category-icon bg-gradient-to-br from-purple-500 to-purple-600">AX</div>
            <span class="text-xs font-bold text-gray-800 text-center">Axis</span>
            <p class="text-[10px] text-gray-500 text-center">Pulsa & Paket</p>
        </div>
        <div onclick="bukaModal('Tri', 'Pulsa', 'bg-gradient-to-br from-pink-500 to-pink-600', '3')" class="card-hover flex flex-col items-center cursor-pointer">
            <div class="category-icon bg-gradient-to-br from-pink-500 to-pink-600">3</div>
            <span class="text-xs font-bold text-gray-800 text-center">Tri</span>
            <p class="text-[10px] text-gray-500 text-center">Pulsa & Paket</p>
        </div>
        <div onclick="bukaModal('Smartfren', 'Pulsa', 'bg-gradient-to-br from-green-500 to-green-600', 'SF')" class="card-hover flex flex-col items-center cursor-pointer">
            <div class="category-icon bg-gradient-to-br from-green-500 to-green-600">SF</div>
            <span class="text-xs font-bold text-gray-800 text-center">Smartfren</span>
            <p class="text-[10px] text-gray-500 text-center">Pulsa & Paket</p>
        </div>
    </div>
    
    <div class="mt-8 px-2">
        <div class="bg-gradient-to-r from-green-50 to-teal-50 border border-green-100 rounded-2xl p-4">
            <h4 class="font-bold text-gray-800 text-sm mb-2">üì∂ Paket Data</h4>
            <p class="text-xs text-gray-600">Tersedia juga paket internet harian, mingguan, dan bulanan untuk semua operator.</p>
        </div>
    </div>
</div>

<div id="pageResi" class="sub-page max-w-md mx-auto">
    <div class="sticky top-0 glass-effect z-10 p-4 rounded-b-3xl mb-6">
        <div class="flex items-center gap-4">
            <button onclick="closeSubPage('pageResi')" class="w-10 h-10 bg-white shadow-md rounded-xl flex items-center justify-center font-bold text-gray-700 hover:bg-gray-50 transition-all">
                ‚Üê
            </button>
            <div>
                <h2 class="text-xl font-bold text-gray-800">Resi Transaksi</h2>
                <p class="text-xs text-gray-500">Detail transaksi terbaru</p>
            </div>
        </div>
    </div>
    
    <div class="px-2">
        <div class="card-white overflow-hidden mb-6">
            <div class="gradient-primary p-8 text-center text-white">
                <div class="w-20 h-20 bg-white/20 rounded-full flex items-center justify-center mx-auto mb-4 shadow-inner">
                    <span class="text-3xl">‚úÖ</span>
                </div>
                <h2 class="text-xl font-bold">Transaksi Berhasil</h2>
                <p class="text-sm opacity-90 mt-1">Official Digital Receipt</p>
            </div>

            <div class="p-6 space-y-5">
                <div class="flex justify-between items-center py-3 border-b border-gray-100">
                    <span class="text-sm text-gray-600 font-medium">Pelanggan</span>
                    <span id="res_user" class="text-sm font-bold text-gray-800">---</span>
                </div>
                <div class="flex justify-between items-center py-3 border-b border-gray-100">
                    <span class="text-sm text-gray-600 font-medium">Waktu</span>
                    <span id="res_jam" class="text-sm font-bold text-gray-800">---</span>
                </div>
                <div class="flex justify-between items-center py-3 border-b border-gray-100">
                    <span class="text-sm text-gray-600 font-medium">Layanan</span>
                    <span id="res_layanan" class="text-sm font-bold text-blue-600">---</span>
                </div>
                <div class="flex justify-between items-center py-3 border-b border-gray-100">
                    <span class="text-sm text-gray-600 font-medium">Total Bayar</span>
                    <span id="res_total" class="text-lg font-bold text-gray-800">---</span>
                </div>
                
                <div class="pt-4">
                    <div class="bg-gray-50 p-4 rounded-xl border border-gray-200 text-center">
                        <span class="text-xs font-bold text-gray-400 uppercase block mb-1">Nomor Referensi</span>
                        <span id="res_id" class="text-sm font-mono font-bold text-gray-600 break-all">---</span>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="space-y-4">
            <button onclick="window.print()" class="w-full btn-primary p-4 rounded-xl font-bold text-lg">
                üì• Download Resi (PDF)
            </button>
            <button onclick="shareResi()" class="w-full p-4 bg-gray-100 text-gray-700 rounded-xl font-bold hover:bg-gray-200 transition-all">
                üîó Bagikan Resi
            </button>
            <p class="text-center text-xs text-gray-500 font-medium">RYD STORE - Payment System Protected</p>
        </div>
    </div>
</div>

<!-- Floating Action Button -->
<button onclick="openTopUp()" class="fab gradient-primary">
    üí∞
</button>

<script>
    // ============================================
    // KONFIGURASI FIREBASE & APLIKASI
    // ============================================
    
    const WA_ADMIN = "6285881934739";
    const APP_NAME = "RYD STORE V.PRO MASTER";
    
    const firebaseConfig = {
        apiKey: "AIzaSyCEeF0D3RB5uthkMKx5rkSTEYii-7Pp0KM",
        authDomain: "riyadistore3.firebaseapp.com",
        databaseURL: "https://riyadistore3-default-rtdb.asia-southeast1.firebasedatabase.app",
        projectId: "riyadistore3",
        storageBucket: "riyadistore3.firebasestorage.app",
        messagingSenderId: "28764528472",
        appId: "1:28764528472:web:941e615ef35d62b4724f2d"
    };
    
    // Inisialisasi Firebase
    if (!firebase.apps.length) {
        firebase.initializeApp(firebaseConfig);
    }
    const db = firebase.database();

    // Variabel global
    let userAktif = null;
    let passAktif = null;
    let saldoAktif = 0;
    let isHide = false;
    let userData = {};
    let transactionHistory = [];

    // ============================================
    // FUNGSI LOGIN & REGISTER
    // ============================================
    
    function renderLogin() {
        document.getElementById('app').innerHTML = `
        <div class="min-h-screen flex flex-col justify-center p-8">
            <div class="text-center mb-10">
                <div class="w-24 h-24 gradient-primary rounded-3xl mx-auto mb-6 flex items-center justify-center text-4xl font-black text-white shadow-xl">
                    RYD
                </div>
                <h1 class="text-3xl font-bold text-gray-800 mb-2">RYD STORE</h1>
                <p class="text-gray-500 text-sm">V.PRO MASTER EDITION</p>
            </div>
            
            <div class="space-y-5">
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">Username</label>
                    <input id="l_u" type="text" placeholder="Masukkan username" 
                           class="w-full p-4 bg-white rounded-xl border border-gray-200 focus:border-blue-500 focus:ring-2 focus:ring-blue-200 outline-none transition-all font-medium shadow-sm">
                </div>
                
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">Password</label>
                    <input id="l_p" type="password" placeholder="Masukkan password" 
                           class="w-full p-4 bg-white rounded-xl border border-gray-200 focus:border-blue-500 focus:ring-2 focus:ring-blue-200 outline-none transition-all font-medium shadow-sm">
                </div>
                
                <div class="flex items-center justify-between">
                    <label class="flex items-center">
                        <input type="checkbox" id="rememberMe" class="mr-2 rounded">
                        <span class="text-sm text-gray-600">Ingat saya</span>
                    </label>
                    <button onclick="lupaPassword()" class="text-sm text-blue-500 hover:text-blue-700 font-medium">
                        Lupa password?
                    </button>
                </div>
                
                <button onclick="doLogin()" class="w-full btn-primary p-4 rounded-xl font-bold text-lg shadow-lg">
                    Masuk Akun
                </button>
                
                <div class="relative my-6">
                    <div class="absolute inset-0 flex items-center">
                        <div class="w-full border-t border-gray-200"></div>
                    </div>
                    <div class="relative flex justify-center text-sm">
                        <span class="px-4 bg-white text-gray-500">Belum punya akun?</span>
                    </div>
                </div>
                
                <button onclick="renderRegister()" class="w-full p-4 border-2 border-blue-500 text-blue-500 rounded-xl font-bold hover:bg-blue-50 transition-all">
                    Daftar Akun Baru
                </button>
            </div>
            
            <div class="mt-10 text-center">
                <p class="text-xs text-gray-400">¬© 2024 RYD STORE OFFICIAL. All rights reserved.</p>
            </div>
        </div>`;
        
        // Cek jika ada data login tersimpan
        const savedUser = localStorage.getItem('ryd_username');
        const savedPass = localStorage.getItem('ryd_password');
        if (savedUser && savedPass && document.getElementById('rememberMe')) {
            document.getElementById('l_u').value = savedUser;
            document.getElementById('l_p').value = savedPass;
            document.getElementById('rememberMe').checked = true;
        }
    }

    function renderRegister() {
        document.getElementById('app').innerHTML = `
        <div class="min-h-screen p-8">
            <button onclick="renderLogin()" class="mb-8 text-gray-500 hover:text-gray-700 flex items-center gap-2">
                ‚Üê Kembali ke Login
            </button>
            
            <div class="text-center mb-8">
                <h2 class="text-2xl font-bold text-gray-800">Daftar Akun Baru</h2>
                <p class="text-gray-500 text-sm">Bergabung dengan RYD STORE</p>
            </div>
            
            <div class="space-y-5">
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">Username</label>
                    <input id="r_u" type="text" placeholder="Pilih username unik" 
                           class="w-full p-4 bg-white rounded-xl border border-gray-200 focus:border-blue-500 focus:ring-2 focus:ring-blue-200 outline-none transition-all font-medium shadow-sm">
                    <p class="text-xs text-gray-500 mt-1">Username tidak bisa diubah setelah pendaftaran</p>
                </div>
                
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">Password</label>
                    <input id="r_p" type="password" placeholder="Minimal 6 karakter" 
                           class="w-full p-4 bg-white rounded-xl border border-gray-200 focus:border-blue-500 focus:ring-2 focus:ring-blue-200 outline-none transition-all font-medium shadow-sm">
                </div>
                
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">Konfirmasi Password</label>
                    <input id="r_p2" type="password" placeholder="Ulangi password" 
                           class="w-full p-4 bg-white rounded-xl border border-gray-200 focus:border-blue-500 focus:ring-2 focus:ring-blue-200 outline-none transition-all font-medium shadow-sm">
                </div>
                
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">Kode Referral (Opsional)</label>
                    <input id="r_ref" type="text" placeholder="Kosongkan jika tidak ada" 
                           class="w-full p-4 bg-white rounded-xl border border-gray-200 focus:border-blue-500 focus:ring-2 focus:ring-blue-200 outline-none transition-all font-medium shadow-sm">
                    <p class="text-xs text-gray-500 mt-1">Dapatkan bonus jika mendaftar dengan kode referral</p>
                </div>
                
                <div class="bg-blue-50 border border-blue-200 rounded-xl p-4 mt-6">
                    <h4 class="font-bold text-blue-800 text-sm mb-2">üìã Syarat & Ketentuan</h4>
                    <ul class="text-xs text-blue-700 space-y-1">
                        <li>‚Ä¢ Username harus unik dan belum terdaftar</li>
                        <li>‚Ä¢ Password minimal 6 karakter</li>
                        <li>‚Ä¢ Simpan baik-baik data login Anda</li>
                        <li>‚Ä¢ Pastikan kode referral valid jika ada</li>
                    </ul>
                </div>
                
                <button onclick="doRegister()" class="w-full btn-primary p-4 rounded-xl font-bold text-lg mt-6 shadow-lg">
                    Daftar Sekarang
                </button>
            </div>
        </div>`;
    }

    function doLogin() {
        const u = document.getElementById('l_u').value.toLowerCase().trim();
        const p = document.getElementById('l_p').value;
        const remember = document.getElementById('rememberMe')?.checked;
        
        if (!u || !p) {
            Swal.fire('Peringatan', 'Username dan password harus diisi!', 'warning');
            return;
        }
        
        // Tampilkan loading
        Swal.fire({
            title: 'Memproses...',
            allowOutsideClick: false,
            didOpen: () => {
                Swal.showLoading();
            }
        });
        
        db.ref('users/' + u).once('value', (snapshot) => {
            Swal.close();
            
            if (snapshot.exists() && snapshot.val().password === p) {
                userAktif = u;
                passAktif = p;
                userData = snapshot.val();
                saldoAktif = userData.saldo || 0;
                
                // Simpan ke localStorage jika remember me dicentang
                if (remember) {
                    localStorage.setItem('ryd_username', u);
                    localStorage.setItem('ryd_password', p);
                } else {
                    localStorage.removeItem('ryd_username');
                    localStorage.removeItem('ryd_password');
                }
                
                // Update last login
                db.ref('users/' + u).update({
                    lastLogin: new Date().toISOString(),
                    loginCount: (userData.loginCount || 0) + 1
                });
                
                renderDashboard();
                
                Swal.fire({
                    title: 'Login Berhasil!',
                    text: `Selamat datang kembali, ${u}!`,
                    icon: 'success',
                    timer: 1500,
                    showConfirmButton: false
                });
                
            } else {
                Swal.fire('Gagal', 'Username atau password salah!', 'error');
            }
        }).catch((error) => {
            Swal.close();
            console.error("Login error:", error);
            Swal.fire('Error', 'Terjadi kesalahan: ' + error.message, 'error');
        });
    }

    function doRegister() {
        const u = document.getElementById('r_u').value.toLowerCase().trim();
        const p = document.getElementById('r_p').value;
        const p2 = document.getElementById('r_p2').value;
        const inputRef = document.getElementById('r_ref').value.toUpperCase().trim();
        
        if (!u || !p || !p2) {
            Swal.fire('Peringatan', 'Data harus diisi lengkap!', 'warning');
            return;
        }
        
        if (p.length < 6) {
            Swal.fire('Error', 'Password minimal 6 karakter!', 'error');
            return;
        }
        
        if (p !== p2) {
            Swal.fire('Error', 'Password tidak cocok!', 'error');
            return;
        }
        
        if (!/^[a-z0-9_]+$/.test(u)) {
            Swal.fire('Error', 'Username hanya boleh huruf kecil, angka, dan underscore!', 'error');
            return;
        }
        
        const myNewRef = generateRandomRef();
        
        Swal.fire({
            title: 'Memproses...',
            allowOutsideClick: false,
            didOpen: () => {
                Swal.showLoading();
            }
        });
        
        db.ref('users/' + u).once('value', (snapshot) => {
            if (snapshot.exists()) {
                Swal.fire('Gagal', 'Username sudah digunakan!', 'error');
                return;
            }
            
            db.ref('users/' + u).set({ 
                password: p, 
                saldo: 0, 
                foto: "", 
                nama: "", 
                wa: "",
                myReferralCode: myNewRef,
                referredBy: inputRef || "NON-REF",
                createdAt: new Date().toISOString(),
                lastLogin: null,
                loginCount: 0,
                totalTransaksi: 0,
                totalSpent: 0
            }).then(() => {
                Swal.fire({
                    title: 'PENDAFTARAN BERHASIL!', 
                    icon: 'success',
                    html: `
                    <div class='text-left'>
                        <div class='bg-gradient-to-r from-green-50 to-blue-50 p-4 rounded-xl border border-green-200 mb-4'>
                            <h4 class='font-bold text-green-800 mb-2'>Data Akun Anda:</h4>
                            <p class='text-sm'><strong>Username:</strong> ${u}</p>
                            <p class='text-sm'><strong>Password:</strong> ${p}</p>
                            <p class='text-sm'><strong>Kode Referral:</strong> ${myNewRef}</p>
                        </div>
                        <p class='text-xs text-gray-600'>Simpan baik-baik data ini untuk login ke akun Anda.</p>
                    </div>`,
                    confirmButtonText: 'SAYA MENGERTI'
                }).then(() => renderLogin());
            }).catch((error) => {
                Swal.fire('Error', 'Gagal mendaftar: ' + error.message, 'error');
            });
        });
    }

    function lupaPassword() {
        Swal.fire({
            title: 'Lupa Password',
            html: `
            <div class="space-y-4">
                <p class="text-sm text-gray-600">Hubungi admin untuk reset password:</p>
                <div class="bg-blue-50 p-4 rounded-xl border border-blue-200">
                    <p class="font-bold text-blue-800 text-center">${WA_ADMIN}</p>
                </div>
                <button onclick="hubungiAdmin()" class="w-full p-3 bg-green-500 text-white rounded-lg font-bold">
                    Hubungi via WhatsApp
                </button>
            </div>`,
            showCancelButton: true,
            cancelButtonText: 'Batal',
            showConfirmButton: false
        });
    }

    function hubungiAdmin() {
        window.location.href = `https://wa.me/${WA_ADMIN}?text=Halo admin, saya lupa password akun RYD STORE.`;
    }

    // ============================================
    // DASHBOARD & FUNGSI UTAMA
    // ============================================
    
    function renderDashboard() {
        db.ref('users/' + userAktif).on('value', (snapshot) => {
            const data = snapshot.val();
            if (!data) {
                Swal.fire('Error', 'Data user tidak ditemukan!', 'error');
                renderLogin();
                return;
            }
            
            userData = data;
            saldoAktif = data.saldo || 0;
            const myFoto = data.foto || "https://cdn-icons-png.flaticon.com/512/149/149071.png";
            const nama = data.nama || userAktif;
            const joinDate = data.createdAt ? new Date(data.createdAt).toLocaleDateString('id-ID') : '-';
            
            // Update informasi di halaman profil
            if (document.getElementById('info_username')) {
                document.getElementById('info_username').textContent = '@' + userAktif;
                document.getElementById('info_refcode').textContent = data.myReferralCode || '-';
                document.getElementById('info_transaksi').textContent = data.totalTransaksi || 0;
                document.getElementById('my_member_since').textContent = 'Member sejak: ' + joinDate;
            }
            
            // Update kode referral di halaman invite
            if (document.getElementById('refCode')) {
                document.getElementById('refCode').textContent = data.myReferralCode || '-';
            }
            
            document.getElementById('app').innerHTML = `
                <div class="min-h-screen">
                    <!-- Header -->
                    <div class="gradient-primary p-6 rounded-b-3xl text-white shadow-lg">
                        <div class="flex justify-between items-center mb-6">
                            <div>
                                <h1 class="text-xl font-bold">RYD STORE</h1>
                                <p class="text-sm opacity-90">V.PRO MASTER EDITION</p>
                            </div>
                            <div class="flex items-center gap-3">
                                <button onclick="openSubPage('pageProfile')" class="p-2 bg-white/20 rounded-xl hover:bg-white/30 transition-all">
                                    üë§
                                </button>
                                <button onclick="openSubPage('pageInvite')" class="p-2 bg-white/20 rounded-xl hover:bg-white/30 transition-all">
                                    üéÅ
                                </button>
                            </div>
                        </div>
                        
                        <!-- Profile & Saldo -->
                        <div class="flex items-center gap-4 mb-6">
                            <img src="${myFoto}" alt="Profile" 
                                 class="w-16 h-16 rounded-2xl object-cover border-4 border-white/30 shadow-lg">
                            <div class="flex-1">
                                <h2 class="font-bold text-lg">${nama}</h2>
                                <p class="text-sm opacity-90">@${userAktif}</p>
                            </div>
                        </div>
                        
                        <!-- Saldo Card -->
                        <div class="bg-white/20 backdrop-blur-sm rounded-2xl p-5 mb-6">
                            <div class="flex justify-between items-center mb-2">
                                <p class="text-sm opacity-90">Saldo Tersedia</p>
                                <button onclick="toggleSaldo()" class="text-white/70 hover:text-white">
                                    ${isHide ? 'üëÅÔ∏è' : 'üï∂Ô∏è'}
                                </button>
                            </div>
                            <div class="flex items-end justify-between">
                                <h1 class="text-3xl font-bold">
                                    ${isHide ? '‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢' : 'Rp ' + saldoAktif.toLocaleString('id-ID')}
                                </h1>
                                <span class="badge bg-white/30 text-white font-bold">IDR</span>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Quick Actions -->
                    <div class="px-6 -mt-8 mb-8">
                        <div class="grid grid-cols-4 gap-4">
                            <button onclick="openTopUp()" class="card-hover card-white p-4 flex flex-col items-center">
                                <div class="w-12 h-12 gradient-primary rounded-xl flex items-center justify-center text-white text-xl mb-2">
                                    ‚¨ÜÔ∏è
                                </div>
                                <span class="text-xs font-bold text-gray-700">Top Up</span>
                            </button>
                            
                            <button onclick="openTransfer()" class="card-hover card-white p-4 flex flex-col items-center">
                                <div class="w-12 h-12 gradient-success rounded-xl flex items-center justify-center text-white text-xl mb-2">
                                    ‚û°Ô∏è
                                </div>
                                <span class="text-xs font-bold text-gray-700">Transfer</span>
                            </button>
                            
                            <button onclick="openSubPage('pageGame')" class="card-hover card-white p-4 flex flex-col items-center">
                                <div class="w-12 h-12 bg-gradient-to-br from-orange-500 to-red-600 rounded-xl flex items-center justify-center text-white text-xl mb-2">
                                    üéÆ
                                </div>
                                <span class="text-xs font-bold text-gray-700">Game</span>
                            </button>
                            
                            <button onclick="openSubPage('pageEwallet')" class="card-hover card-white p-4 flex flex-col items-center">
                                <div class="w-12 h-12 bg-gradient-to-br from-blue-500 to-purple-600 rounded-xl flex items-center justify-center text-white text-xl mb-2">
                                    üí∞
                                </div>
                                <span class="text-xs font-bold text-gray-700">E-Wallet</span>
                            </button>
                        </div>
                    </div>
                    
                    <!-- Categories -->
                    <div class="px-6 mb-8">
                        <h3 class="font-bold text-gray-800 mb-4">Kategori Lainnya</h3>
                        <div class="grid grid-cols-4 gap-3">
                            <button onclick="openSubPage('pagePulsa')" class="card-hover card-white p-3 flex flex-col items-center">
                                <div class="w-10 h-10 bg-gradient-to-br from-green-500 to-teal-600 rounded-lg flex items-center justify-center text-white mb-1">
                                    üì±
                                </div>
                                <span class="text-[10px] font-bold text-gray-700 text-center">Pulsa</span>
                            </button>
                            
                            <button onclick="openSubPage('pageBank')" class="card-hover card-white p-3 flex flex-col items-center">
                                <div class="w-10 h-10 bg-gradient-to-br from-gray-700 to-gray-900 rounded-lg flex items-center justify-center text-white mb-1">
                                    üè¶
                                </div>
                                <span class="text-[10px] font-bold text-gray-700 text-center">Bank</span>
                            </button>
                            
                            <button onclick="loadHistory()" class="card-hover card-white p-3 flex flex-col items-center">
                                <div class="w-10 h-10 bg-gradient-to-br from-purple-500 to-pink-600 rounded-lg flex items-center justify-center text-white mb-1">
                                    üìú
                                </div>
                                <span class="text-[10px] font-bold text-gray-700 text-center">Riwayat</span>
                            </button>
                            
                            <button onclick="openSubPage('pageProfile')" class="card-hover card-white p-3 flex flex-col items-center">
                                <div class="w-10 h-10 bg-gradient-to-br from-amber-500 to-orange-600 rounded-lg flex items-center justify-center text-white mb-1">
                                    ‚öôÔ∏è
                                </div>
                                <span class="text-[10px] font-bold text-gray-700 text-center">Profil</span>
                            </button>
                        </div>
                    </div>
                    
                    <!-- Transaction History -->
                    <div class="px-6">
                        <div class="flex justify-between items-center mb-4">
                            <h3 class="font-bold text-gray-800">Riwayat Transaksi</h3>
                            <button onclick="loadHistory()" class="text-sm text-blue-500 font-medium">Lihat Semua ‚Üí</button>
                        </div>
                        
                        <div id="hist_container" class="space-y-3">
                            <!-- History akan dimuat di sini -->
                        </div>
                        
                        <div class="text-center py-8 text-gray-400" id="emptyHistory">
                            <div class="text-4xl mb-3">üìä</div>
                            <p class="text-sm">Belum ada transaksi</p>
                            <p class="text-xs mt-1">Mulai dengan melakukan top up atau pembelian</p>
                        </div>
                    </div>
                    
                    <!-- Bottom Navigation -->
                    <div class="fixed bottom-0 left-0 right-0 max-w-md mx-auto bg-white border-t border-gray-200 p-4 grid grid-cols-5">
                        <button onclick="renderDashboard()" class="flex flex-col items-center text-blue-600">
                            <span class="text-xl">üè†</span>
                            <span class="text-[10px] font-bold mt-1">Home</span>
                        </button>
                        <button onclick="openSubPage('pageGame')" class="flex flex-col items-center text-gray-500 hover:text-blue-600">
                            <span class="text-xl">üéÆ</span>
                            <span class="text-[10px] font-bold mt-1">Game</span>
                        </button>
                        <button onclick="openTopUp()" class="flex flex-col items-center text-gray-500 hover:text-blue-600">
                            <span class="text-xl">üí∞</span>
                            <span class="text-[10px] font-bold mt-1">Top Up</span>
                        </button>
                        <button onclick="openSubPage('pagePulsa')" class="flex flex-col items-center text-gray-500 hover:text-blue-600">
                            <span class="text-xl">üì±</span>
                            <span class="text-[10px] font-bold mt-1">Pulsa</span>
                        </button>
                        <button onclick="openSubPage('pageProfile')" class="flex flex-col items-center text-gray-500 hover:text-blue-600">
                            <span class="text-xl">üë§</span>
                            <span class="text-[10px] font-bold mt-1">Profil</span>
                        </button>
                    </div>
                    
                    <div class="pb-24"></div>
                </div>
            `;
            
            loadRecentHistory();
        });
    }

    // ============================================
    // FUNGSI PRODUK & TRANSAKSI
    // ============================================
    
    function bukaModal(name, tipe, brandColor, initial) {
        document.getElementById('modalTitle').innerText = `${name} - ${tipe}`;
        document.getElementById('inputTujuan').value = "";
        const list = document.getElementById('listProduk');
        list.innerHTML = "";
        
        let itm = [];
        if (name === 'Royal Dream') {
            itm = [
                {l:'100M', b:8000}, 
                {l:'200M', b:15000}, 
                {l:'500M', b:34000}, 
                {l:'1B', b:65000}, 
                {l:'2B', b:129000}, 
                {l:'5B', b:320000}, 
                {l:'10B', b:640000}
            ];
        } else if (name === 'Mobile Legends') {
            itm = [
                {l:'11 Diamond', b:3000}, 
                {l:'50 Diamond', b:12000}, 
                {l:'172 Diamond', b:38000}, 
                {l:'257 Diamond', b:58000}, 
                {l:'706 Diamond', b:155000}, 
                {l:'2195 Diamond', b:480000}, 
                {l:'4830 Diamond', b:980000}
            ];
        } else if (name === 'Free Fire') {
            itm = [
                {l:'70 Diamond', b:9000}, 
                {l:'140 Diamond', b:18000}, 
                {l:'355 Diamond', b:45000}, 
                {l:'720 Diamond', b:90000}, 
                {l:'1440 Diamond', b:180000}, 
                {l:'7290 Diamond', b:950000}
            ];
        } else if (tipe === 'E-Wallet' || tipe === 'Pulsa') {
            itm = [
                {l:'5.000', b:5000}, 
                {l:'10.000', b:10000}, 
                {l:'20.000', b:20000}, 
                {l:'50.000', b:50000}, 
                {l:'100.000', b:100000}, 
                {l:'200.000', b:200000}, 
                {l:'500.000', b:500000}, 
                {l:'1.000.000', b:1000000}
            ];
        } else {
            itm = [
                {l:'Paket Lite', b:15000}, 
                {l:'Paket Basic', b:45000}, 
                {l:'Paket Pro', b:90000}, 
                {l:'Paket Mega', b:450000}, 
                {l:'Paket Ultra', b:980000}
            ];
        }

        itm.forEach(it => {
            let untung = 0;
            if (it.b <= 50000) {
                untung = 1500;
            } else if (it.b <= 499999) {
                untung = 2000;
            } else if (it.b <= 1000000) {
                untung = 5000;
            } else {
                untung = 10000;
            }

            let total = it.b + untung;
            list.innerHTML += `
            <div onclick="beli('${name}', '${it.l}', ${total}, '${tipe}')" 
                 class="card-hover card-white p-4 text-center cursor-pointer">
                <div class="category-icon ${brandColor} mx-auto mb-3 text-sm">${initial}</div>
                <p class="font-bold text-gray-800 text-sm">${it.l}</p>
                <p class="text-xs text-gray-500 mt-1">Harga Normal</p>
                <p class="text-lg font-bold text-blue-600 mt-1">Rp ${total.toLocaleString('id-ID')}</p>
                <div class="mt-2 text-[10px] text-green-600 font-medium">
                    ‚úì Tersedia
                </div>
            </div>`;
        });
        
        document.getElementById('modalProduk').style.display = 'flex';
    }

    function beli(p, i, h, t) {
        const no = document.getElementById('inputTujuan').value.trim();
        if (!no) {
            Swal.fire('Peringatan', 'ID/Nomor tujuan harus diisi!', 'warning');
            return;
        }
        
        if (saldoAktif < h) {
            Swal.fire({
                title: 'Saldo Tidak Cukup!',
                text: `Saldo Anda Rp ${saldoAktif.toLocaleString()}, dibutuhkan Rp ${h.toLocaleString()}`,
                icon: 'error',
                showCancelButton: true,
                confirmButtonText: 'Top Up Saldo',
                cancelButtonText: 'Batal'
            }).then((result) => {
                if (result.isConfirmed) {
                    tutupModal();
                    openTopUp();
                }
            });
            return;
        }

        Swal.fire({ 
            title: 'Konfirmasi Pembelian',
            html: `
            <div class="text-left">
                <div class="bg-gray-50 p-4 rounded-xl mb-4">
                    <p class="font-bold text-gray-800">Detail Pembelian:</p>
                    <p class="text-sm mt-2"><strong>Produk:</strong> ${p} ${i}</p>
                    <p class="text-sm"><strong>Tujuan:</strong> ${no}</p>
                    <p class="text-sm"><strong>Total:</strong> Rp ${h.toLocaleString()}</p>
                </div>
                <p class="text-sm text-gray-600">Masukkan password untuk melanjutkan:</p>
            </div>`,
            input: 'password', 
            inputPlaceholder: 'Password akun Anda',
            showCancelButton: true, 
            confirmButtonColor: '#10b981',
            confirmButtonText: 'Beli Sekarang',
            preConfirm: (pass) => {
                if (!pass) {
                    Swal.showValidationMessage('Password harus diisi');
                }
                return pass;
            }
        }).then(res => {
            if (res.value === passAktif) {
                // Kurangi saldo
                const newSaldo = saldoAktif - h;
                db.ref('users/' + userAktif).update({
                    saldo: newSaldo,
                    totalTransaksi: (userData.totalTransaksi || 0) + 1,
                    totalSpent: (userData.totalSpent || 0) + h
                });
                
                // Simpan history
                saveHistory(`${p} ${i} ke ${no}`, h);
                
                // Kirim ke WhatsApp Admin
                const pesan = `*ORDER BARU*%0A%0AUser: *${userAktif.toUpperCase()}*%0AItem: *${p} ${i}*%0ATujuan: *${no}*%0AHarga: *Rp ${h.toLocaleString()}*%0A%0AStatus: *MENUNGGU PROSES*%0A%0A_Silahkan proses pesanan ini segera._`;
                window.open(`https://wa.me/${WA_ADMIN}?text=${pesan}`, '_blank');
                
                Swal.fire({
                    title: 'Berhasil!',
                    html: `
                    <div class="text-center">
                        <div class="w-16 h-16 bg-green-100 rounded-full flex items-center justify-center mx-auto mb-4">
                            <span class="text-2xl">‚úÖ</span>
                        </div>
                        <p class="font-bold text-gray-800">Pembelian Berhasil</p>
                        <p class="text-sm text-gray-600 mt-2">Pesanan sedang diproses oleh admin</p>
                    </div>`,
                    icon: 'success',
                    timer: 3000,
                    showConfirmButton: false
                });
                
                tutupModal();
                
            } else if (res.isConfirmed) { 
                Swal.fire('Gagal', 'Password salah!', 'error'); 
            }
        });
    }

    // ============================================
    // FUNGSI TRANSFER SALDO
    // ============================================
    
    function openTransfer() {
        document.getElementById('saldoTransfer').textContent = 'Rp ' + saldoAktif.toLocaleString('id-ID');
        document.getElementById('modalTransfer').style.display = 'flex';
    }

    function tutupModalTransfer() {
        document.getElementById('modalTransfer').style.display = 'none';
        document.getElementById('tfUsername').value = '';
        document.getElementById('tfAmount').value = '';
    }

    function prosesTransfer() {
        const tujuan = document.getElementById('tfUsername').value.toLowerCase().trim();
        const jumlah = parseInt(document.getElementById('tfAmount').value);
        
        if (!tujuan) {
            Swal.fire('Peringatan', 'Username tujuan harus diisi!', 'warning');
            return;
        }
        
        if (!jumlah || jumlah < 10000) {
            Swal.fire('Peringatan', 'Minimal transfer Rp 10.000!', 'warning');
            return;
        }
        
        if (tujuan === userAktif) {
            Swal.fire('Peringatan', 'Tidak bisa transfer ke diri sendiri!', 'warning');
            return;
        }
        
        if (jumlah > saldoAktif) {
            Swal.fire('Gagal', 'Saldo tidak mencukupi!', 'error');
            return;
        }
        
        Swal.fire({
            title: 'Konfirmasi Transfer',
            html: `
            <div class="text-left">
                <div class="bg-blue-50 p-4 rounded-xl mb-4">
                    <p class="font-bold text-gray-800">Detail Transfer:</p>
                    <p class="text-sm mt-2"><strong>Ke:</strong> @${tujuan}</p>
                    <p class="text-sm"><strong>Jumlah:</strong> Rp ${jumlah.toLocaleString()}</p>
                </div>
                <p class="text-sm text-gray-600">Masukkan password untuk melanjutkan:</p>
            </div>`,
            input: 'password',
            inputPlaceholder: 'Password akun Anda',
            showCancelButton: true,
            confirmButtonText: 'Transfer Sekarang',
            preConfirm: (pass) => {
                if (!pass) {
                    Swal.showValidationMessage('Password harus diisi');
                }
                return pass;
            }
        }).then(res => {
            if (res.value === passAktif) {
                // Cek apakah user tujuan ada
                db.ref('users/' + tujuan).once('value', (snapshot) => {
                    if (!snapshot.exists()) {
                        Swal.fire('Gagal', 'User tujuan tidak ditemukan!', 'error');
                        return;
                    }
                    
                    const tujuanData = snapshot.val();
                    
                    // Kurangi saldo pengirim
                    const newSaldoSender = saldoAktif - jumlah;
                    db.ref('users/' + userAktif).update({
                        saldo: newSaldoSender
                    });
                    
                    // Tambah saldo penerima
                    const newSaldoReceiver = (tujuanData.saldo || 0) + jumlah;
                    db.ref('users/' + tujuan).update({
                        saldo: newSaldoReceiver
                    });
                    
                    // Simpan history untuk pengirim
                    saveHistory(`Transfer ke @${tujuan}`, jumlah);
                    
                    // Simpan history untuk penerima
                    const tgl = new Date().toLocaleString('id-ID', { 
                        dateStyle: 'short', 
                        timeStyle: 'short' 
                    }).replace(/\//g, '-');
                    
                    db.ref('history/' + tujuan).push({
                        item: `Transfer dari @${userAktif}`,
                        price: jumlah,
                        date: tgl,
                        type: 'credit'
                    });
                    
                    Swal.fire({
                        title: 'Transfer Berhasil!',
                        html: `
                        <div class="text-center">
                            <div class="w-16 h-16 bg-green-100 rounded-full flex items-center justify-center mx-auto mb-4">
                                <span class="text-2xl">‚úÖ</span>
                            </div>
                            <p class="font-bold text-gray-800">Rp ${jumlah.toLocaleString()}</p>
                            <p class="text-sm text-gray-600 mt-2">Terkirim ke @${tujuan}</p>
                        </div>`,
                        icon: 'success',
                        timer: 3000,
                        showConfirmButton: false
                    });
                    
                    tutupModalTransfer();
                    renderDashboard();
                    
                }).catch(error => {
                    Swal.fire('Error', 'Terjadi kesalahan: ' + error.message, 'error');
                });
                
            } else if (res.isConfirmed) {
                Swal.fire('Gagal', 'Password salah!', 'error');
            }
        });
    }

    // ============================================
    // FUNGSI TOP UP SALDO
    // ============================================
    
    function openTopUp() {
        document.getElementById('modalTopUp').style.display = 'flex';
        document.getElementById('topupAmount').value = '';
    }

    function tutupModalTopUp() {
        document.getElementById('modalTopUp').style.display = 'none';
    }

    function setTopUpAmount(amount) {
        document.getElementById('topupAmount').value = amount;
    }

    function prosesTopUp() {
        const amount = parseInt(document.getElementById('topupAmount').value);
        
        if (!amount || amount < 10000) {
            Swal.fire('Peringatan', 'Minimal top up Rp 10.000!', 'warning');
            return;
        }
        
        Swal.fire({
            title: 'Konfirmasi Top Up',
            html: `
            <div class="text-left">
                <div class="bg-blue-50 p-4 rounded-xl mb-4">
                    <p class="font-bold text-gray-800">Detail Top Up:</p>
                    <p class="text-sm mt-2"><strong>Jumlah:</strong> Rp ${amount.toLocaleString()}</p>
                    <p class="text-sm"><strong>User:</strong> @${userAktif}</p>
                </div>
                <p class="text-sm text-gray-600">Anda akan diarahkan ke WhatsApp untuk konfirmasi pembayaran.</p>
            </div>`,
            showCancelButton: true,
            confirmButtonText: 'Lanjutkan ke WhatsApp',
            confirmButtonColor: '#25D366'
        }).then(res => {
            if (res.isConfirmed) {
                const pesan = `*TOP UP SALDO*%0A%0AUser: *${userAktif.toUpperCase()}*%0AJumlah: *Rp ${amount.toLocaleString()}*%0A%0A_Silahkan konfirmasi pembayaran untuk menambah saldo._`;
                window.open(`https://wa.me/${WA_ADMIN}?text=${pesan}`, '_blank');
                tutupModalTopUp();
            }
        });
    }

    // ============================================
    // FUNGSI PROFIL & UTILITAS
    // ============================================
    
    function prosesFoto() {
        const file = document.getElementById('up_foto').files[0];
        if (!file) return;
        
        // Validasi ukuran file (max 2MB)
        if (file.size > 2 * 1024 * 1024) {
            Swal.fire('Error', 'Ukuran file maksimal 2MB!', 'error');
            return;
        }
        
        // Validasi tipe file
        if (!file.type.match('image.*')) {
            Swal.fire('Error', 'File harus berupa gambar!', 'error');
            return;
        }
        
        const reader = new FileReader();
        reader.onloadend = () => { 
            Swal.fire({
                title: 'Memproses...',
                allowOutsideClick: false,
                didOpen: () => {
                    Swal.showLoading();
                }
            });
            
            db.ref('users/' + userAktif + '/foto').set(reader.result)
                .then(() => {
                    Swal.close();
                    Swal.fire({ 
                        title: 'Berhasil!',
                        text: 'Foto profil berhasil diperbarui', 
                        icon: 'success',
                        timer: 1500,
                        showConfirmButton: false
                    });
                    renderDashboard();
                })
                .catch(error => {
                    Swal.fire('Error', 'Gagal mengupload foto: ' + error.message, 'error');
                });
        };
        reader.readAsDataURL(file);
    }

    function saveDataProfil() {
        const n = document.getElementById('up_nama').value.trim();
        const w = document.getElementById('up_wa').value.trim();
        
        if (!w && n) {
            Swal.fire('Peringatan', 'Nomor WhatsApp diperlukan!', 'warning');
            return;
        }
        
        if (w && !/^[0-9]{10,15}$/.test(w)) {
            Swal.fire('Error', 'Nomor WhatsApp tidak valid!', 'error');
            return;
        }
        
        Swal.fire({
            title: 'Memproses...',
            allowOutsideClick: false,
            didOpen: () => {
                Swal.showLoading();
            }
        });
        
        db.ref('users/' + userAktif).update({ 
            nama: n, 
            wa: w 
        }).then(() => { 
            Swal.close();
            Swal.fire({
                title: 'Berhasil!',
                text: 'Profil berhasil disimpan',
                icon: 'success',
                timer: 1500,
                showConfirmButton: false
            });
            closeSubPage('pageProfile');
            renderDashboard();
        }).catch(error => {
            Swal.fire('Error', 'Gagal menyimpan profil: ' + error.message, 'error');
        });
    }

    function generateRandomRef() {
        const chars = "ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789";
        let result = "RYD";
        for (let i = 0; i < 4; i++) {
            result += chars.charAt(Math.floor(Math.random() * chars.length));
        }
        return result;
    }

    function toggleSaldo() { 
        isHide = !isHide; 
        renderDashboard(); 
    }

    function openSubPage(id) {
        const target = document.getElementById(id);
        if (target) {
            target.classList.add('active');
            document.body.style.overflow = 'hidden';
            
            // Load data jika diperlukan
            if (id === 'pageProfile') {
                loadProfileData();
            } else if (id === 'pageBank') {
                renderBankList();
            } else if (id === 'pageInvite') {
                document.getElementById('refCode').textContent = userData.myReferralCode || '-';
            }
        }
    }

    function closeSubPage(id) {
        const target = document.getElementById(id);
        if (target) {
            target.classList.remove('active');
            document.body.style.overflow = 'auto';
        }
    }

    function tutupModal() { 
        document.getElementById('modalProduk').style.display = 'none';
    }

    function loadProfileData() {
        if (userData) {
            document.getElementById('my_display_name').textContent = userData.nama || '@' + userAktif;
            document.getElementById('up_nama').value = userData.nama || '';
            document.getElementById('up_wa').value = userData.wa || '';
            document.getElementById('my_photo').src = userData.foto || "https://cdn-icons-png.flaticon.com/512/149/149071.png";
            
            if (userData.createdAt) {
                const joinDate = new Date(userData.createdAt).toLocaleDateString('id-ID', {
                    weekday: 'long',
                    year: 'numeric',
                    month: 'long',
                    day: 'numeric'
                });
                document.getElementById('my_member_since').textContent = 'Member sejak: ' + joinDate;
            }
            
            document.getElementById('info_username').textContent = '@' + userAktif;
            document.getElementById('info_refcode').textContent = userData.myReferralCode || '-';
            document.getElementById('info_transaksi').textContent = userData.totalTransaksi || 0;
        }
    }

    function salinRef() {
        const code = document.getElementById('refCode').textContent;
        if (navigator.clipboard) {
            navigator.clipboard.writeText(code)
                .then(() => {
                    Swal.fire({
                        title: 'Berhasil!',
                        text: 'Kode referral berhasil disalin',
                        icon: 'success',
                        timer: 1500,
                        showConfirmButton: false
                    });
                })
                .catch(err => {
                    fallbackCopyText(code);
                });
        } else {
            fallbackCopyText(code);
        }
    }

    function fallbackCopyText(text) {
        const textArea = document.createElement("textarea");
        textArea.value = text;
        document.body.appendChild(textArea);
        textArea.select();
        document.execCommand('copy');
        document.body.removeChild(textArea);
        
        Swal.fire({
            title: 'Berhasil!',
            text: 'Kode referral berhasil disalin',
            icon: 'success',
            timer: 1500,
            showConfirmButton: false
        });
    }

    function shareToWhatsApp() {
        const code = document.getElementById('refCode').textContent;
        const message = `Halo! Saya ingin mengajak kamu bergabung di RYD STORE. Gunakan kode referral saya: *${code}* untuk mendapatkan bonus saldo! üéÅ`;
        window.open(`https://wa.me/?text=${encodeURIComponent(message)}`, '_blank');
    }

    function shareToTelegram() {
        const code = document.getElementById('refCode').textContent;
        const message = `Halo! Saya ingin mengajak kamu bergabung di RYD STORE. Gunakan kode referral saya: ${code} untuk mendapatkan bonus saldo! üéÅ`;
        window.open(`https://t.me/share/url?url=${encodeURIComponent('https://rydstore.com')}&text=${encodeURIComponent(message)}`, '_blank');
    }

    function konfirmasiLogout() {
        Swal.fire({
            title: 'Konfirmasi Logout',
            text: 'Apakah Anda yakin ingin keluar dari akun?',
            icon: 'question',
            showCancelButton: true,
            confirmButtonText: 'Ya, Keluar',
            cancelButtonText: 'Batal',
            confirmButtonColor: '#ef4444'
        }).then((result) => {
            if (result.isConfirmed) {
                // Clear data
                userAktif = null;
                passAktif = null;
                saldoAktif = 0;
                userData = {};
                
                // Kembali ke halaman login
                renderLogin();
                
                Swal.fire({
                    title: 'Berhasil Logout',
                    text: 'Anda telah keluar dari akun',
                    icon: 'success',
                    timer: 1500,
                    showConfirmButton: false
                });
            }
        });
    }

    // ============================================
    // FUNGSI RIWAYAT TRANSAKSI
    // ============================================
    
    function loadRecentHistory() {
        const container = document.getElementById('hist_container');
        const emptyMsg = document.getElementById('emptyHistory');
        
        if (!container) return;
        
        db.ref('history/' + userAktif).orderByKey().limitToLast(5).once('value', (snapshot) => {
            container.innerHTML = "";
            
            if (snapshot.exists()) {
                const data = snapshot.val();
                const transactions = [];
                
                Object.keys(data).forEach(key => {
                    transactions.push({
                        id: key,
                        ...data[key]
                    });
                });
                
                // Urutkan dari yang terbaru
                transactions.reverse();
                
                transactions.forEach(trans => {
                    const isCredit = trans.type === 'credit';
                    container.innerHTML += `
                    <div onclick="bukaResi('${trans.item}', '${trans.price}', '${trans.date}', '${trans.id}')" 
                         class="transaction-item card-white p-4 cursor-pointer">
                        <div class="flex justify-between items-start">
                            <div>
                                <h4 class="font-bold text-gray-800 text-sm">${trans.item}</h4>
                                <p class="text-xs text-gray-500 mt-1">${trans.date}</p>
                            </div>
                            <div class="text-right">
                                <span class="text-sm font-bold ${isCredit ? 'text-green-600' : 'text-red-600'}">
                                    ${isCredit ? '+' : '-'}Rp ${parseInt(trans.price).toLocaleString()}
                                </span>
                                <p class="text-[10px] font-medium text-gray-400 mt-1">Lihat Detail</p>
                            </div>
                        </div>
                    </div>`;
                });
                
                if (emptyMsg) emptyMsg.style.display = 'none';
            } else {
                if (emptyMsg) emptyMsg.style.display = 'block';
            }
        }).catch(error => {
            console.error("Error loading history:", error);
        });
    }

    function loadHistory() {
        Swal.fire({
            title: 'Memuat Riwayat...',
            allowOutsideClick: false,
            didOpen: () => {
                Swal.showLoading();
            }
        });
        
        db.ref('history/' + userAktif).once('value', (snapshot) => {
            Swal.close();
            
            if (snapshot.exists()) {
                const data = snapshot.val();
                const transactions = [];
                
                Object.keys(data).forEach(key => {
                    transactions.push({
                        id: key,
                        ...data[key]
                    });
                });
                
                // Urutkan dari yang terbaru
                transactions.reverse();
                
                // Tampilkan dalam modal
                let historyHTML = `
                <div class="text-center mb-6">
                    <h3 class="text-lg font-bold text-gray-800">Riwayat Transaksi</h3>
                    <p class="text-sm text-gray-500">Total: ${transactions.length} transaksi</p>
                </div>
                <div class="max-h-96 overflow-y-auto space-y-3">`;
                
                transactions.forEach(trans => {
                    const isCredit = trans.type === 'credit';
                    historyHTML += `
                    <div class="transaction-item bg-gray-50 p-4 rounded-xl">
                        <div class="flex justify-between items-start">
                            <div>
                                <h4 class="font-bold text-gray-800 text-sm">${trans.item}</h4>
                                <p class="text-xs text-gray-500 mt-1">${trans.date}</p>
                            </div>
                            <div class="text-right">
                                <span class="text-sm font-bold ${isCredit ? 'text-green-600' : 'text-red-600'}">
                                    ${isCredit ? '+' : '-'}Rp ${parseInt(trans.price).toLocaleString()}
                                </span>
                            </div>
                        </div>
                    </div>`;
                });
                
                historyHTML += `</div>`;
                
                Swal.fire({
                    title: '',
                    html: historyHTML,
                    showConfirmButton: false,
                    showCloseButton: true,
                    width: '90%',
                    padding: '20px'
                });
                
            } else {
                Swal.fire({
                    title: 'Belum Ada Transaksi',
                    text: 'Anda belum melakukan transaksi apapun',
                    icon: 'info',
                    confirmButtonText: 'Mengerti'
                });
            }
        });
    }

    function saveHistory(item, harga) {
        const tgl = new Date().toLocaleString('id-ID', { 
            dateStyle: 'short', 
            timeStyle: 'short' 
        }).replace(/\//g, '-');
        
        db.ref('history/' + userAktif).push({
            item: item,
            price: harga,
            date: tgl,
            type: 'debit'
        });
    }

    // ============================================
    // FUNGSI BANK
    // ============================================
    
    const daftarBank = [
        { n: "BCA", c: "bg-gradient-to-br from-blue-800 to-blue-900" }, 
        { n: "BRI", c: "bg-gradient-to-br from-blue-600 to-blue-700" }, 
        { n: "MANDIRI", c: "bg-gradient-to-br from-yellow-500 to-yellow-600" },
        { n: "BNI", c: "bg-gradient-to-br from-orange-600 to-orange-700" }, 
        { n: "BSI", c: "bg-gradient-to-br from-teal-700 to-teal-800" }, 
        { n: "SEA BANK", c: "bg-gradient-to-br from-orange-500 to-orange-600" },
        { n: "BANK JAGO", c: "bg-gradient-to-br from-orange-400 to-orange-500" }, 
        { n: "ALOBANK", c: "bg-gradient-to-br from-pink-500 to-pink-600" }, 
        { n: "NEOBANK", c: "bg-gradient-to-br from-yellow-400 to-yellow-500" },
        { n: "BLU", c: "bg-gradient-to-br from-blue-400 to-blue-500" }, 
        { n: "DANAMON", c: "bg-gradient-to-br from-orange-700 to-orange-800" }, 
        { n: "CIMB NIAGA", c: "bg-gradient-to-br from-red-700 to-red-800" },
        { n: "PERMATA", c: "bg-gradient-to-br from-green-600 to-green-700" }, 
        { n: "BTN", c: "bg-gradient-to-br from-blue-900 to-black" }, 
        { n: "MAYBANK", c: "bg-gradient-to-br from-yellow-600 to-yellow-700" }
    ];

    function renderBankList() {
        const container = document.getElementById('listBank');
        if (!container) return;
        
        container.innerHTML = "";
        daftarBank.forEach(b => {
            container.innerHTML += `
                <div onclick="bukaFormBank('${b.n}', '${b.c}')" class="bank-item card-hover card-white p-4 flex items-center gap-4 cursor-pointer">
                    <div class="w-12 h-12 ${b.c} rounded-xl flex items-center justify-center text-white font-bold text-xs">
                        ${b.n.substring(0,3)}
                    </div>
                    <div>
                        <span class="font-bold text-gray-800 block">${b.n}</span>
                        <span class="text-xs text-gray-500">Transfer Bank</span>
                    </div>
                </div>`;
        });
    }

    function filterBank() {
        let input = document.getElementById('searchBank').value.toUpperCase();
        let items = document.getElementsByClassName('bank-item');
        for (let i = 0; i < items.length; i++) {
            let text = items[i].getElementsByTagName("span")[0].innerText;
            items[i].style.display = text.indexOf(input) > -1 ? "" : "none";
        }
    }

    function bukaFormBank(namaBank, warna) {
        Swal.fire({
            title: `<div class="flex items-center gap-3">
                        <div class="w-10 h-10 ${warna} rounded-lg flex items-center justify-center text-white font-bold">
                            ${namaBank.substring(0,3)}
                        </div>
                        <div>
                            <h4 class="font-bold text-gray-800">Transfer ${namaBank}</h4>
                            <p class="text-xs text-gray-500">Isi data transfer dengan benar</p>
                        </div>
                    </div>`,
            html: `
                <div class="space-y-4 mt-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">No. Rekening Tujuan</label>
                        <input id="rek_no" type="text" 
                            class="w-full p-4 bg-gray-50 rounded-xl border border-gray-200 focus:border-blue-500 focus:ring-2 focus:ring-blue-200 outline-none transition-all font-medium" 
                            placeholder="Contoh: 1234567890">
                    </div>
                    
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Nama Penerima</label>
                        <input id="rek_nama" type="text" 
                            class="w-full p-4 bg-gray-50 rounded-xl border border-gray-200 focus:border-blue-500 focus:ring-2 focus:ring-blue-200 outline-none transition-all font-medium" 
                            placeholder="Nama sesuai rekening">
                    </div>
                    
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Nominal Transfer</label>
                        <input id="rek_nom" type="number" 
                            class="w-full p-4 bg-gray-50 rounded-xl border border-gray-200 focus:border-blue-500 focus:ring-2 focus:ring-blue-200 outline-none transition-all font-medium" 
                            placeholder="Minimal Rp 50.000" 
                            oninput="hitungAdmin(this.value)">
                    </div>
                    
                    <div id="admin_info" class="p-4 bg-blue-50 border-2 border-blue-100 rounded-xl">
                        <p class="text-xs font-bold text-blue-600 uppercase mb-1">Total Bayar</p>
                        <h2 id="total_bayar" class="text-xl font-bold text-gray-800">Rp 0</h2>
                        <p class="text-xs text-gray-500 mt-1">Termasuk biaya admin</p>
                    </div>
                </div>
            `,
            showCancelButton: true,
            cancelButtonText: 'Batal',
            confirmButtonText: 'Lanjutkan',
            width: '90%',
            padding: '1.5rem',
            customClass: {
                confirmButton: '!btn-primary !rounded-xl !font-bold !px-6 !py-3',
                cancelButton: '!bg-gray-100 !text-gray-700 !rounded-xl !font-bold !px-6 !py-3',
                popup: '!rounded-3xl'
            },
            didOpen: () => {
                Swal.getConfirmButton().disabled = true;
            },
            preConfirm: () => {
                const rek = document.getElementById('rek_no').value;
                const nama = document.getElementById('rek_nama').value;
                const nominal = parseInt(document.getElementById('rek_nom').value);
                
                if (!rek || !nama || !nominal) {
                    Swal.showValidationMessage('Semua data harus diisi!');
                    return false;
                }
                
                if (nominal < 50000) {
                    Swal.showValidationMessage('Minimal Rp 50.000!');
                    return false;
                }
                
                return { rek, nama, nominal };
            }
        }).then(res => {
            if (res.isConfirmed) {
                mintaPasswordBank(namaBank, res.value.rek, res.value.nama, res.value.nominal);
            }
        });
    }

    function hitungAdmin(val) {
        const n = parseInt(val) || 0;
        const totalText = document.getElementById('total_bayar');
        const btnLanjut = Swal.getConfirmButton();

        if (n < 50000) {
            totalText.innerText = "Minimal Rp 50.000";
            totalText.className = "text-xl font-bold text-red-600";
            if (btnLanjut) btnLanjut.disabled = true;
            return;
        }

        let untung = (n <= 50000) ? 1500 : (n <= 499999) ? 2000 : (n <= 1000000) ? 5000 : 10000;
        const total = n + untung;

        if (total > saldoAktif) {
            totalText.innerText = "Saldo Tidak Cukup!";
            totalText.className = "text-xl font-bold text-red-600";
            if (btnLanjut) btnLanjut.disabled = true;
        } else {
            totalText.innerText = "Rp " + total.toLocaleString('id-ID');
            totalText.className = "text-xl font-bold text-gray-800";
            if (btnLanjut) btnLanjut.disabled = false;
        }
    }

    function mintaPasswordBank(bank, rek, nama, nom) {
        let untung = (nom <= 50000) ? 1500 : (nom <= 499999) ? 2000 : (nom <= 1000000) ? 5000 : 10000;
        let total = nom + untung;

        Swal.fire({
            title: 'Konfirmasi Transfer',
            html: `
            <div class="text-left">
                <div class="bg-blue-50 p-4 rounded-xl mb-4">
                    <p class="font-bold text-gray-800">Detail Transfer Bank:</p>
                    <p class="text-sm mt-2"><strong>Bank:</strong> ${bank}</p>
                    <p class="text-sm"><strong>Rekening:</strong> ${rek}</p>
                    <p class="text-sm"><strong>Nama:</strong> ${nama}</p>
                    <p class="text-sm"><strong>Nominal:</strong> Rp ${nom.toLocaleString()}</p>
                    <p class="text-sm font-bold text-blue-600"><strong>Total Bayar:</strong> Rp ${total.toLocaleString()}</p>
                </div>
                <p class="text-sm text-gray-600">Masukkan password untuk melanjutkan:</p>
            </div>`,
            input: 'password',
            inputPlaceholder: 'Password akun Anda',
            showCancelButton: true,
            confirmButtonColor: '#10b981',
            confirmButtonText: 'Konfirmasi Transfer',
            preConfirm: (pass) => {
                if (!pass) {
                    Swal.showValidationMessage('Password harus diisi');
                }
                return pass;
            }
        }).then(result => {
            if (result.isConfirmed && result.value === passAktif) {
                // Kurangi saldo
                const newSaldo = saldoAktif - total;
                db.ref('users/' + userAktif).update({
                    saldo: newSaldo,
                    totalTransaksi: (userData.totalTransaksi || 0) + 1,
                    totalSpent: (userData.totalSpent || 0) + total
                })
                .then(() => {
                    saveHistory(`TF Bank ${bank} ke ${nama}`, total);
                    
                    const pesanWA = `*TRANSFER BANK*%0A%0AUser: *${userAktif.toUpperCase()}*%0ABank: *${bank}*%0ARekening: *${rek}*%0ANama: *${nama}*%0ANominal: *Rp ${nom.toLocaleString()}*%0ATotal Bayar: *Rp ${total.toLocaleString()}*%0A%0AStatus: *PENDING (SALDO TERPOTONG)*%0A%0A_Silahkan proses transfer ini segera._`;
                    
                    window.open(`https://wa.me/${WA_ADMIN}?text=${pesanWA}`, '_blank');
                    
                    Swal.fire({
                        title: 'Berhasil!',
                        html: `
                        <div class="text-center">
                            <div class="w-16 h-16 bg-green-100 rounded-full flex items-center justify-center mx-auto mb-4">
                                <span class="text-2xl">‚úÖ</span>
                            </div>
                            <p class="font-bold text-gray-800">Transfer Diproses</p>
                            <p class="text-sm text-gray-600 mt-2">Admin akan memproses transfer Anda</p>
                        </div>`,
                        icon: 'success',
                        timer: 3000,
                        showConfirmButton: false
                    });
                    
                })
                .catch((error) => {
                    Swal.fire('Error', 'Gagal mengurangi saldo: ' + error.message, 'error');
                });
            }
        });
    }

    // ============================================
    // FUNGSI RESI
    // ============================================
    
    function bukaResi(layanan, harga, waktu, idResi) {
        document.getElementById('res_user').textContent = userAktif.toUpperCase();
        document.getElementById('res_jam').textContent = waktu;
        document.getElementById('res_layanan').textContent = layanan;
        document.getElementById('res_total').textContent = "Rp " + parseInt(harga).toLocaleString('id-ID');
        document.getElementById('res_id').textContent = "RYD-" + idResi.toUpperCase().substring(0, 8);
        openSubPage('pageResi');
    }

    function shareResi() {
        const resi = document.getElementById('res_id').textContent;
        const pesan = `Resi Transaksi RYD STORE%0A%0AID Resi: *${resi}*%0APelanggan: *${userAktif.toUpperCase()}*%0aLayanan: *${document.getElementById('res_layanan').textContent}*%0aTotal: *${document.getElementById('res_total').textContent}*%0aWaktu: *${document.getElementById('res_jam').textContent}*`;
        
        Swal.fire({
            title: 'Bagikan Resi',
            text: 'Pilih platform untuk membagikan resi:',
            showCancelButton: true,
            showDenyButton: true,
            confirmButtonText: 'WhatsApp',
            denyButtonText: 'Salin Teks',
            cancelButtonText: 'Batal'
        }).then((result) => {
            if (result.isConfirmed) {
                window.open(`https://wa.me/?text=${encodeURIComponent(pesan)}`, '_blank');
            } else if (result.isDenied) {
                navigator.clipboard.writeText(pesan.replace(/%0a/gi, '\n').replace(/%0A/gi, '\n'));
                Swal.fire('Berhasil!', 'Resi berhasil disalin', 'success');
            }
        });
    }

    // ============================================
    // INISIALISASI APLIKASI
    // ============================================
    
    document.addEventListener('DOMContentLoaded', () => {
        // Cek jika ada user yang tersimpan di localStorage
        const savedUser = localStorage.getItem('ryd_username');
        const savedPass = localStorage.getItem('ryd_password');
        
        if (savedUser && savedPass) {
            // Auto login dengan data yang tersimpan
            document.getElementById('app').innerHTML = `
            <div class="min-h-screen flex items-center justify-center">
                <div class="text-center">
                    <div class="loading-spinner"></div>
                    <p class="mt-4 text-gray-600 font-medium">Memuat aplikasi...</p>
                </div>
            </div>`;
            
            // Coba login otomatis
            setTimeout(() => {
                db.ref('users/' + savedUser).once('value', (snapshot) => {
                    if (snapshot.exists() && snapshot.val().password === savedPass) {
                        userAktif = savedUser;
                        passAktif = savedPass;
                        userData = snapshot.val();
                        saldoAktif = userData.saldo || 0;
                        renderDashboard();
                    } else {
                        renderLogin();
                    }
                }).catch(() => {
                    renderLogin();
                });
            }, 1000);
        } else {
            renderLogin();
        }
        
        // Tambahkan event listener untuk menutup modal dengan ESC
        document.addEventListener('keydown', (e) => {
            if (e.key === 'Escape') {
                tutupModal();
                tutupModalTransfer();
                tutupModalTopUp();
            }
        });
    });
</script>

</body>
</html>
