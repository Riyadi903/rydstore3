<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>RYD STORE FIX</title>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-100">
    <div id="app" class="max-w-md mx-auto min-h-screen bg-white shadow-lg">
        <div id="loading" class="p-20 text-center font-bold text-blue-600">MENGHUBUNGKAN KE DATABASE...</div>
    </div>

<script>
    const firebaseConfig = {
        apiKey: "AIzaSyAgv7_Ysh6_Pz0q7VvF_Ew8A0p-6pM46eE",
        databaseURL: "https://rydstore3-default-rtdb.asia-southeast1.firebasedatabase.app",
        projectId: "rydstore3"
    };

    try {
        if (!firebase.apps.length) firebase.initializeApp(firebaseConfig);
        const db = firebase.database();
        
        // Cek apakah database bisa diakses
        db.ref('.info/connected').on('value', (s) => {
            if (s.val() === true) {
                renderLogin();
            } else {
                document.getElementById('app').innerHTML = '<div class="p-10 text-center text-red-500">Gagal terhubung ke database. Periksa koneksi internet atau Rules Firebase.</div>';
            }
        });
    } catch (e) {
        document.getElementById('app').innerHTML = '<div class="p-10 text-center text-red-500 font-bold">Error: ' + e.message + '</div>';
    }

    function renderLogin() {
        document.getElementById('app').innerHTML = `
            <div class="p-10 pt-24 text-center">
                <div class="w-20 h-20 bg-blue-600 rounded-3xl mx-auto mb-6 flex items-center justify-center shadow-lg text-white text-4xl font-black">R</div>
                <h1 class="text-3xl font-black text-slate-800 mb-8 uppercase">RYD STORE</h1>
                <div class="space-y-4">
                    <input id="u" type="text" placeholder="Username" class="w-full p-4 bg-gray-50 border rounded-2xl outline-none focus:ring-2 focus:ring-blue-600">
                    <input id="p" type="password" placeholder="Password" class="w-full p-4 bg-gray-50 border rounded-2xl outline-none focus:ring-2 focus:ring-blue-600">
                    <button onclick="doLogin()" class="w-full bg-blue-600 text-white p-4 rounded-2xl font-bold">MASUK</button>
                    <button onclick="renderRegister()" class="w-full text-blue-600 font-bold text-sm">Daftar Member</button>
                </div>
            </div>`;
    }

    // Fungsi doLogin dan renderRegister tetap menggunakan logika sebelumnya.
    function doLogin() {
        const u = document.getElementById('u').value.trim().toLowerCase();
        const p = document.getElementById('p').value;
        firebase.database().ref('users/' + u).once('value', (s) => {
            if(s.exists() && s.val().password === p) {
                alert("Berhasil Masuk!");
                // Lanjut ke dashboard
            } else { alert("Data tidak ditemukan atau salah."); }
        });
    }

    function renderRegister() {
        document.getElementById('app').innerHTML = `
            <div class="p-10 pt-20">
                <h2 class="text-2xl font-black mb-8 uppercase text-slate-800">Daftar Akun</h2>
                <div class="space-y-4">
                    <input id="ru" type="text" placeholder="Buat Username" class="w-full p-4 bg-gray-50 border rounded-2xl outline-none">
                    <input id="rp" type="password" placeholder="Buat Password" class="w-full p-4 bg-gray-50 border rounded-2xl outline-none">
                    <button onclick="doRegister()" class="w-full bg-green-600 text-white p-4 rounded-2xl font-bold">DAFTAR</button>
                    <button onclick="renderLogin()" class="w-full text-gray-400 font-bold text-sm mt-4 text-center">Kembali</button>
                </div>
            </div>`;
    }

    function doRegister() {
        const u = document.getElementById('ru').value.trim().toLowerCase();
        const p = document.getElementById('rp').value;
        if(u.length < 3) return alert("Username terlalu pendek.");
        firebase.database().ref('users/' + u).set({ password: p, saldo: 0 }).then(() => {
            alert("Pendaftaran Berhasil!");
            renderLogin();
        });
    }
</script>
</body>
</html>
