<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>RYD STORE v3.0 - Pro Digital Payment</title>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;600;700;800&display=swap');
        body { font-family: 'Plus Jakarta Sans', sans-serif; background-color: #f8fafc; }
        .btn-press:active { transform: scale(0.95); opacity: 0.9; }
        .gradient-blue { background: linear-gradient(135deg, #1e3a8a 0%, #3b82f6 100%); }
    </style>
</head>
<body>

<div id="app" class="max-w-md mx-auto min-h-screen bg-white shadow-2xl relative flex flex-col"></div>

<script>
    // --- KONFIGURASI ---
    const WA_ADMIN = "6285881934739";
    const PROFIT = 1500; // Keuntungan per transaksi
    const firebaseConfig = {
        apiKey: "AIzaSyAgv7_Ysh6_Pz0q7VvF_Ew8A0p-6pM46eE",
        authDomain: "rydstore3.firebaseapp.com",
        databaseURL: "https://rydstore3-default-rtdb.asia-southeast1.firebasedatabase.app",
        projectId: "rydstore3",
        storageBucket: "rydstore3.appspot.com",
        messagingSenderId: "338805214041",
        appId: "1:338805214041:web:248106d91079366e60977e"
    };

    if (!firebase.apps.length) firebase.initializeApp(firebaseConfig);
    const db = firebase.database();
    let userAktif = localStorage.getItem('ryd_session');

    const nominals = [5000, 10000, 15000, 20000, 25000, 30000, 50000, 100000, 150000, 200000];
    const providers = [
        { name: 'Telkomsel', img: 'https://upload.wikimedia.org/wikipedia/commons/b/bc/Telkomsel_2021_icon.svg', color: 'bg-red-50' },
        { name: 'Indosat', img: 'https://upload.wikimedia.org/wikipedia/commons/a/a8/Indosat_Ooredoo_logo.svg', color: 'bg-yellow-50' },
        { name: 'XL Axiata', img: 'https://upload.wikimedia.org/wikipedia/commons/5/5c/XL_Axiata_logo_2016.svg', color: 'bg-blue-50' },
        { name: 'Axis', img: 'https://upload.wikimedia.org/wikipedia/commons/8/83/Axis_logo_2014.svg', color: 'bg-purple-50' },
        { name: 'Three', img: 'https://upload.wikimedia.org/wikipedia/commons/4/40/3-id-logo.svg', color: 'bg-gray-100' },
        { name: 'Smartfren', img: 'https://upload.wikimedia.org/wikipedia/commons/d/d0/Smartfren_logo.svg', color: 'bg-pink-50' }
    ];

    function render(html) { document.getElementById('app').innerHTML = html; }

    // --- HALAMAN LOGIN ---
    function pageLogin() {
        render(`
            <div class="p-10 pt-32 text-center flex-1">
                <div class="w-20 h-20 gradient-blue rounded-3xl mx-auto mb-6 flex items-center justify-center shadow-xl">
                    <span class="text-white text-4xl font-black italic">R</span>
                </div>
                <h1 class="text-3xl font-extrabold text-slate-800 tracking-tighter">RYD STORE</h1>
                <p class="text-slate-400 text-xs font-bold uppercase tracking-[0.3em] mb-12">Digital Payment</p>
                <div class="space-y-4">
                    <input id="l_user" type="text" placeholder="Username" class="w-full p-4 bg-slate-100 rounded-2xl outline-none focus:ring-2 focus:ring-blue-500">
                    <input id="l_pass" type="password" placeholder="Password" class="w-full p-4 bg-slate-100 rounded-2xl outline-none focus:ring-2 focus:ring-blue-500">
                    <button onclick="doLogin()" class="w-full gradient-blue text-white p-4 rounded-2xl font-bold btn-press shadow-lg">MASUK</button>
                    <button onclick="pageRegister()" class="w-full text-blue-600 font-bold text-sm">Daftar Akun Baru</button>
                </div>
            </div>
        `);
    }

    // --- HALAMAN DAFTAR ---
    function pageRegister() {
        render(`
            <div class="p-10 pt-20 flex-1">
                <h2 class="text-2xl font-black text-slate-800 mb-2 uppercase">Daftar Akun</h2>
                <p class="text-slate-400 text-sm mb-10">Mulai bisnis pulsa Anda sekarang.</p>
                <div class="space-y-4">
                    <input id="r_user" type="text" placeholder="Buat Username" class="w-full p-4 bg-slate-100 rounded-2xl outline-none">
                    <input id="r_pass" type="password" placeholder="Buat Password" class="w-full p-4 bg-slate-100 rounded-2xl outline-none">
                    <button onclick="doRegister()" class="w-full bg-emerald-600 text-white p-4 rounded-2xl font-bold btn-press shadow-lg">DAFTAR SEKARANG</button>
                    <button onclick="pageLogin()" class="w-full text-slate-400 font-bold text-sm py-4">Kembali ke Login</button>
                </div>
            </div>
        `);
    }

    // --- HALAMAN DASHBOARD ---
    function pageDashboard() {
        db.ref('users/' + userAktif).on('value', (s) => {
            const data = s.val();
            if(!data) return;
            render(`
                <div class="gradient-blue p-6 pb-24 rounded-b-[3.5rem] shadow-xl text-white">
                    <div class="flex justify-between items-center mb-10">
                        <div>
                            <p class="text-[10px] font-bold opacity-60 uppercase tracking-widest">Saldo Member</p>
                            <h2 class="text-3xl font-black">Rp ${Number(data.saldo || 0).toLocaleString('id-ID')}</h2>
                        </div>
                        <button onclick="logout()" class="bg-white/10 p-2 rounded-xl text-[10px] font-bold border border-white/20">LOGOUT</button>
                    </div>
                    <p class="text-sm font-bold opacity-80 uppercase tracking-tighter">@${userAktif}</p>
                </div>

                <div class="px-5 -mt-12 flex-1">
                    <div class="bg-white p-5 rounded-[2.5rem] shadow-2xl flex justify-around mb-8 border border-slate-50">
                        <button onclick="pageTransfer()" class="flex flex-col items-center btn-press">
                            <div class="w-14 h-14 bg-blue-50 rounded-2xl flex items-center justify-center text-blue-600 mb-1 text-xl font-bold shadow-inner">TF</div>
                            <span class="text-[10px] font-black text-slate-400 uppercase">Transfer</span>
                        </button>
                        <button onclick="sendWA('Halo Admin, saya mau ISI SALDO user: ${userAktif}')" class="flex flex-col items-center btn-press">
                            <div class="w-14 h-14 bg-orange-50 rounded-2xl flex items-center justify-center text-orange-600 mb-1 text-2xl font-bold shadow-inner">+</div>
                            <span class="text-[10px] font-black text-slate-400 uppercase">Top Up</span>
                        </button>
                    </div>

                    <h3 class="font-black text-slate-800 mb-4 px-2 text-xs uppercase tracking-widest text-center">Layanan Pulsa</h3>
                    <div class="grid grid-cols-3 gap-3 pb-10">
                        ${providers.map(p => `
                            <div onclick="pageProduct('${p.name}')" class="${p.color} p-4 rounded-3xl flex flex-col items-center btn-press border border-white shadow-sm">
                                <img src="${p.img}" class="h-8 w-8 mb-2 object-contain">
                                <span class="font-bold text-slate-600 text-[8px] uppercase text-center">${p.name}</span>
                            </div>
                        `).join('')}
                    </div>
                </div>
            `);
        });
    }

    // --- HALAMAN PRODUK ---
    function pageProduct(provider) {
        let html = `
            <div class="p-6">
                <div class="flex items-center mb-8">
                    <button onclick="pageDashboard()" class="text-3xl mr-4 text-slate-800 font-bold">←</button>
                    <h2 class="text-xl font-black text-slate-800 uppercase italic">Pulsa ${provider}</h2>
                </div>
                <div class="bg-blue-50 p-6 rounded-3xl mb-6 border border-blue-100">
                    <p class="text-[10px] font-bold text-blue-400 uppercase mb-2 text-center">Masukkan Nomor Tujuan</p>
                    <input id="no_tujuan" type="number" placeholder="08xxxxxx" class="w-full bg-transparent text-2xl font-black text-center outline-none border-b-2 border-blue-200">
                </div>
                <div class="grid grid-cols-1 gap-3">
        `;
        nominals.forEach(n => {
            const hargaJual = n + PROFIT;
            html += `
                <div onclick="doOrder('${provider}', ${n}, ${hargaJual})" class="flex justify-between p-5 bg-slate-50 border border-slate-100 rounded-3xl items-center btn-press">
                    <div>
                        <p class="text-xl font-black text-slate-800 tracking-tighter">${n/1000}K</p>
                        <p class="text-[10px] font-bold text-slate-400 uppercase">Pulsa Reguler</p>
                    </div>
                    <p class="font-black text-blue-600 text-lg">Rp ${hargaJual.toLocaleString()}</p>
                </div>
            `;
        });
        render(html + `</div></div>`);
    }

    // --- HALAMAN TRANSFER ---
    function pageTransfer() {
        render(`
            <div class="p-6">
                <div class="flex items-center mb-8">
                    <button onclick="pageDashboard()" class="text-3xl mr-4 text-slate-800 font-bold">←</button>
                    <h2 class="text-xl font-black text-slate-800 uppercase italic">Transfer Saldo</h2>
                </div>
                <div class="space-y-4">
                    <div class="bg-gray-50 p-6 rounded-3xl">
                        <label class="text-[10px] font-black text-slate-400 uppercase tracking-widest">Username Tujuan</label>
                        <input id="tf_target" type="text" placeholder="Username penerima" class="w-full bg-transparent text-lg font-bold outline-none border-b-2 border-gray-200">
                    </div>
                    <div class="bg-gray-50 p-6 rounded-3xl">
                        <label class="text-[10px] font-black text-slate-400 uppercase tracking-widest">Nominal Transfer</label>
                        <input id="tf_amount" type="number" placeholder="0" class="w-full bg-transparent text-3xl font-black text-blue-600 outline-none border-b-2 border-gray-200">
                    </div>
                    <button onclick="doTransfer()" class="w-full gradient-blue text-white p-5 rounded-3xl font-black shadow-lg btn-press uppercase">Kirim Saldo</button>
                </div>
            </div>
        `);
    }

    // --- FUNGSI LOGIKA ---

    function doLogin() {
        const u = document.getElementById('l_user').value.toLowerCase().trim();
        const p = document.getElementById('l_pass').value;
        db.ref('users/' + u).once('value', (s) => {
            if(s.exists() && s.val().password === p) {
                userAktif = u; localStorage.setItem('ryd_session', u); pageDashboard();
            } else { alert("User atau Password salah!"); }
        });
    }

    function doRegister() {
        const u = document.getElementById('r_user').value.toLowerCase().trim();
        const p = document.getElementById('r_pass').value;
        if(u.length < 3 || p === "") return alert("Data tidak valid!");
        db.ref('users/' + u).set({ password: p, saldo: 0 }).then(() => { alert("Sukses! Silakan login."); pageLogin(); });
    }

    function logout() { localStorage.removeItem('ryd_session'); location.reload(); }

    function doOrder(provider, nominal, harga) {
        const no = document.getElementById('no_tujuan').value;
        if(no.length < 10) return alert("Nomor tidak valid!");

        db.ref('users/' + userAktif).once('value', (s) => {
            const saldoSkrg = s.val().saldo || 0;
            if(saldoSkrg < harga) return alert("Saldo tidak cukup! Silakan Top Up.");

            // Potong Saldo Otomatis
            db.ref('users/' + userAktif).update({ saldo: saldoSkrg - harga });
            
            const msg = `ORDER PULSA\n----------\nProduk: ${provider} ${nominal}\nTujuan: ${no}\nUsername: ${userAktif}\nStatus: Saldo Terpotong\n----------\nMohon diproses Admin!`;
            sendWA(msg);
        });
    }

    function doTransfer() {
        const target = document.getElementById('tf_target').value.toLowerCase().trim();
        const amount = parseInt(document.getElementById('tf_amount').value);
        if(!target || amount < 1000) return alert("Minimal transfer Rp 1.000");
        if(target === userAktif) return alert("Tidak bisa kirim ke diri sendiri!");

        db.ref('users/' + userAktif).once('value', (my) => {
            const mySaldo = my.val().saldo || 0;
            if(mySaldo < amount) return alert("Saldo Anda kurang!");

            db.ref('users/' + target).once('value', (tg) => {
                if(!tg.exists()) return alert("User tujuan tidak ditemukan!");
                
                // Proses Transfer
                db.ref('users/' + userAktif).update({ saldo: mySaldo - amount });
                db.ref('users/' + target).update({ saldo: (tg.val().saldo || 0) + amount });
                
                alert("Transfer Berhasil ke " + target);
                pageDashboard();
            });
        });
    }

    function sendWA(msg) { window.location.href = `https://wa.me/${WA_ADMIN}?text=${encodeURIComponent(msg)}`; }

    if(userAktif) pageDashboard(); else pageLogin();
</script>
</body>
</html>
