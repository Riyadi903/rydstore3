<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>RYD STORE OFFICIAL - Secure Digital Exchange</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/firebase/9.15.0/firebase-app-compat.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/firebase/9.15.0/firebase-database-compat.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Urbanist:wght@400;600;800&display=swap');
        body { background: #f0f9f4; font-family: 'Urbanist', sans-serif; }
        .glass-ui { background: rgba(255, 255, 255, 0.9); backdrop-filter: blur(12px); border: 1px solid #ffffff; }
        .btn-gradient { background: linear-gradient(135deg, #10b981 0%, #059669 100%); transition: 0.3s; }
        .btn-gradient:active { transform: scale(0.96); }
        .card-product { background: white; border: 1px solid #e2e8f0; transition: 0.3s; }
        .card-product:hover { border-color: #10b981; transform: translateY(-2px); }
        .fade-in { animation: fadeIn 0.6s ease-out; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
    </style>
</head>
<body class="p-4 flex justify-center items-start min-h-screen">

    <div id="auth-panel" class="w-full max-w-md mt-6 fade-in">
        <div class="glass-ui p-8 rounded-[2.5rem] shadow-2xl border-b-8 border-emerald-600">
            <div class="text-center mb-8">
                <div class="w-24 h-24 bg-emerald-600 rounded-[2rem] flex items-center justify-center mx-auto mb-4 shadow-xl rotate-3">
                    <i class="fa-solid fa-bolt-lightning text-white text-4xl"></i>
                </div>
                <h1 class="text-3xl font-extrabold text-slate-800 tracking-tight">RYD STORE</h1>
                <p class="text-[10px] text-emerald-600 font-bold uppercase tracking-[0.3em] mt-1">Keamanan Transaksi Manusia</p>
            </div>

            <div class="space-y-4">
                <div class="relative">
                    <i class="fa-solid fa-id-badge absolute left-4 top-4 text-emerald-400"></i>
                    <input type="text" id="id-user" placeholder="Username" class="w-full pl-12 p-4 rounded-2xl border border-slate-200 outline-none focus:border-emerald-500 bg-white/50 font-semibold">
                </div>
                <div class="relative">
                    <i class="fa-solid fa-shield-keyhole absolute left-4 top-4 text-emerald-400"></i>
                    <input type="password" id="id-pass" placeholder="Password" class="w-full pl-12 p-4 rounded-2xl border border-slate-200 outline-none focus:border-emerald-500 bg-white/50 font-semibold">
                </div>

                <div id="reg-ext" class="hidden space-y-4 fade-in">
                    <input type="text" id="id-ref" placeholder="ID Teman Pengajak (Opsional)" class="w-full p-4 rounded-2xl border border-emerald-100 outline-none bg-emerald-50/50">
                    <div class="p-4 bg-amber-50 border-2 border-dashed border-amber-300 rounded-2xl">
                        <p class="text-[10px] text-amber-700 font-black text-center uppercase">ðŸ“¸ Ambil Screenshot SEKARANG<br>Setelah klik tombol daftar!</p>
                    </div>
                </div>

                <button onclick="handleAuth()" id="btn-main" class="w-full btn-gradient text-white p-5 rounded-2xl font-extrabold shadow-lg shadow-emerald-100 uppercase tracking-widest mt-2">Masuk Akun</button>
                
                <div class="text-center pt-4">
                    <p class="text-sm font-semibold text-slate-400">
                        <span id="label-mode">Belum punya akun?</span>
                        <button onclick="toggleMode()" class="text-emerald-600 font-black ml-1 uppercase underline underline-offset-4">Klik Disini</button>
                    </p>
                </div>
            </div>
        </div>
    </div>

    <div id="app-panel" class="w-full max-w-md hidden fade-in">
        <div class="glass-ui p-6 rounded-[2.5rem] mb-6 shadow-xl border-b-8 border-emerald-600 relative overflow-hidden">
            <div class="relative z-10 flex justify-between items-start">
                <div>
                    <p class="text-[10px] font-black text-emerald-500 uppercase tracking-widest mb-1">Total Saldo</p>
                    <h2 class="text-4xl font-extrabold text-slate-900 tracking-tighter">Rp <span id="val-saldo">0</span></h2>
                    <div class="mt-2 inline-flex items-center px-3 py-1 bg-emerald-100 text-emerald-700 rounded-full text-[10px] font-black uppercase">
                        ID: <span id="val-user" class="ml-1"></span>
                    </div>
                </div>
                <button onclick="location.reload()" class="w-12 h-12 bg-red-50 text-red-500 rounded-2xl flex items-center justify-center hover:bg-red-500 hover:text-white transition-all shadow-sm">
                    <i class="fa-solid fa-power-off"></i>
                </button>
            </div>
        </div>

        <div class="grid grid-cols-2 gap-4 mb-8">
            <button onclick="topupWA()" class="bg-white p-5 rounded-[2rem] shadow-md flex flex-col items-center gap-2 border-b-4 border-emerald-100">
                <div class="w-12 h-12 bg-emerald-600 text-white rounded-2xl flex items-center justify-center shadow-lg"><i class="fa-solid fa-wallet"></i></div>
                <span class="font-black text-[10px] text-slate-600 uppercase">Isi Saldo</span>
            </button>
            <button onclick="transferUI()" class="bg-white p-5 rounded-[2rem] shadow-md flex flex-col items-center gap-2 border-b-4 border-teal-100">
                <div class="w-12 h-12 bg-teal-500 text-white rounded-2xl flex items-center justify-center shadow-lg"><i class="fa-solid fa-paper-plane"></i></div>
                <span class="font-black text-[10px] text-slate-600 uppercase">Transfer</span>
            </button>
        </div>

        <h3 class="font-black text-xs text-slate-800 uppercase tracking-widest mb-4 px-2">ðŸ›’ Katalog Digital</h3>
        <div id="catalog-grid" class="grid grid-cols-2 gap-3 mb-10"></div>

        <div class="bg-slate-900 p-8 rounded-[2.5rem] text-center border-t-4 border-emerald-500 shadow-2xl">
            <h4 class="text-white font-extrabold text-sm uppercase mb-1">Undang Teman Sekarang</h4>
            <p class="text-emerald-400 text-[10px] font-bold mb-5 tracking-widest">Dapatkan Bonus Rp 5.000 Per User</p>
            <button onclick="shareLink()" class="w-full bg-emerald-500 text-white py-4 rounded-2xl font-black text-xs uppercase shadow-lg">
                <i class="fa-solid fa-share-nodes mr-2"></i> Bagikan Kode Referral
            </button>
        </div>
    </div>

    <script>
        // 1. DATABASE CONFIG (Pastikan URL ini sudah benar)
        const firebaseConfig = { databaseURL: "https://riyadistore3-default-rtdb.firebaseio.com/" };
        firebase.initializeApp(firebaseConfig);
        const db = firebase.database();

        let currentUser = null;
        let isReg = false;

        // 2. DATA PRODUK (KEUNTUNGAN 1.500 & 500)
        const products = [
            { n: "Royal Dream 1B", p: 66500, i: "fa-gem" },
            { n: "Royal Dream 2B", p: 132000, i: "fa-gem" },
            { n: "Pulsa 5.000", p: 7000, i: "fa-mobile" },
            { n: "Pulsa 10.000", p: 12500, i: "fa-mobile" },
            { n: "Pulsa 50.000", p: 51500, i: "fa-mobile" },
            { n: "Saldo 100k", p: 101500, i: "fa-wallet" },
            { n: "Saldo 500k", p: 501500, i: "fa-coins" },
            { n: "Saldo 1 Juta", p: 1001500, i: "fa-crown" }
        ];

        // 3. AUTH LOGIC (DIPERKUAT)
        function toggleMode() {
            isReg = !isReg;
            document.getElementById('reg-ext').classList.toggle('hidden');
            document.getElementById('label-mode').innerText = isReg ? 'Sudah punya akun?' : 'Belum punya akun?';
            document.getElementById('btn-main').innerText = isReg ? 'Daftar & Simpan Akun' : 'Masuk Akun';
        }

        async function handleAuth() {
            const user = document.getElementById('id-user').value.toLowerCase().trim();
            const pass = document.getElementById('id-pass').value;
            const ref = document.getElementById('id-ref').value.trim();

            if (!user || !pass) return Swal.fire('Gagal', 'Username/Password kosong!', 'error');

            const dbRef = db.ref('users/' + user);
            
            try {
                const snap = await dbRef.once('value');
                
                if (isReg) {
                    if (snap.exists()) return Swal.fire('Gagal', 'Username sudah terpakai!', 'warning');
                    
                    await dbRef.set({ username: user, password: pass, saldo: 0, upline: ref || "Sistem" });
                    
                    await Swal.fire({
                        title: 'AKUN DIBUAT!',
                        html: `<div style="text-align:left; background:#fff9c4; p:20px; border-radius:15px; border:2px dashed #fbc02d">
                                <p style="color:red; font-weight:900; text-align:center">ðŸ“¸ SCREENSHOT SEKARANG!</p><hr>
                                <p><b>ID:</b> ${user}</p><p><b>Sandi:</b> ${pass}</p>
                               </div>`,
                        icon: 'success'
                    });
                    location.reload();
                } else {
                    const data = snap.val();
                    if (data && data.password === pass) {
                        startApp(data);
                    } else {
                        Swal.fire('Gagal Login', 'Data tidak cocok atau Rules Database terkunci!', 'error');
                    }
                }
            } catch (err) {
                Swal.fire('Database Error', 'Akses Ditolak! Pastikan Rules Firebase sudah di-SET ke TRUE.', 'error');
            }
        }

        // 4. MAIN APP LOGIC
        function startApp(data) {
            currentUser = data.username;
            document.getElementById('auth-panel').classList.add('hidden');
            document.getElementById('app-panel').classList.remove('hidden');
            document.getElementById('val-user').innerText = currentUser;
            
            // Render Katalog
            const grid = document.getElementById('catalog-grid');
            grid.innerHTML = products.map(p => `
                <div onclick="beli('${p.n}', ${p.p})" class="card-product p-5 rounded-[2rem] text-center cursor-pointer active:scale-95">
                    <i class="fa-solid ${p.i} text-emerald-600 text-xl mb-2"></i>
                    <p class="font-black text-[10px] text-slate-400 uppercase">${p.n}</p>
                    <p class="text-emerald-600 font-extrabold text-sm">Rp ${p.p.toLocaleString()}</p>
                </div>
            `).join('');

            // Realtime Saldo
            db.ref('users/' + currentUser + '/saldo').on('value', (s) => {
                document.getElementById('val-saldo').innerText = (s.val() || 0).toLocaleString();
            });
        }

        // 5. KEAMANAN TRANSAKSI (ANTI-CHEAT)
        async function beli(n, p) {
            const snap = await db.ref('users/' + currentUser).once('value');
            const data = snap.val();

            if (data.saldo < p) return Swal.fire('Gagal', 'Saldo tidak cukup!', 'error');

            const { value: passConfirm } = await Swal.fire({
                title: 'Konfirmasi Sandi',
                text: `Beli ${n}?`,
                input: 'password',
                confirmButtonColor: '#10b981',
                showCancelButton: true
            });

            if (passConfirm === data.password) {
                await db.ref('users/' + currentUser).update({ saldo: data.saldo - p });
                Swal.fire('Berhasil!', 'Saldo dipotong, hubungi admin...', 'success');
                setTimeout(() => window.location.href = `https://wa.me/6281283303643?text=Beli%20${n}%20ID:%20${currentUser}`, 1500);
            } else if (passConfirm) {
                Swal.fire('Salah', 'Sandi Keamanan Salah!', 'error');
            }
        }

        // 6. FITUR TRANSFER LENGKAP
        async function transferUI() {
            const { value: target } = await Swal.fire({ title: 'Username Penerima', input: 'text' });
            if (!target) return;
            const { value: juml } = await Swal.fire({ title: 'Jumlah Transfer', input: 'number' });
            const nominal = parseInt(juml);

            if (nominal < 1000) return Swal.fire('Gagal', 'Minimal Rp 1.000', 'warning');

            const sSnap = await db.ref('users/' + currentUser).once('value');
            const tSnap = await db.ref('users/' + target.toLowerCase()).once('value');

            if (sSnap.val().saldo < nominal) return Swal.fire('Error', 'Saldo kurang!', 'error');
            if (!tSnap.exists()) return Swal.fire('Error', 'User tidak ditemukan!', 'error');

            const { value: p } = await Swal.fire({ title: 'Password Anda', input: 'password', confirmButtonColor: '#10b981' });
            if (p === sSnap.val().password) {
                await db.ref('users/' + currentUser).update({ saldo: sSnap.val().saldo - nominal });
                await db.ref('users/' + target.toLowerCase()).update({ saldo: (tSnap.val().saldo || 0) + nominal });
                Swal.fire('Sukses!', 'Saldo terkirim!', 'success');
            }
        }

        function shareLink() {
            const text = `Top Up Murah & Aman di RYD STORE!\nLink: ${window.location.href}\nReferral: ${currentUser}`;
            window.location.href = `https://wa.me/?text=${encodeURIComponent(text)}`;
        }

        function topupWA() { window.location.href = "https://wa.me/6281283303643?text=Isi%20Saldo%20RYD"; }
    </script>
</body>
</html>
