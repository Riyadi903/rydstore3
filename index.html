<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>RYD STORE OFFICIAL - Keamanan Manusia</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/firebase/9.15.0/firebase-app-compat.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/firebase/9.15.0/firebase-database-compat.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;600;800&display=swap');

        body { 
            background-color: #f0fdf4; 
            font-family: 'Plus Jakarta Sans', sans-serif;
            -webkit-tap-highlight-color: transparent;
        }

        .glass-card {
            background: #ffffff;
            border: 1px solid #dcfce7;
            box-shadow: 0 10px 25px -5px rgba(22, 163, 74, 0.05);
        }

        .btn-green {
            background: linear-gradient(135deg, #16a34a 0%, #15803d 100%);
            color: white;
            transition: all 0.3s ease;
        }

        .btn-green:active {
            transform: scale(0.95);
        }

        .product-item {
            background: white;
            border: 1px solid #f0fdf4;
            transition: all 0.2s ease;
        }

        .product-item:active {
            border-color: #16a34a;
            background: #f0fdf4;
        }

        /* Custom Animasi */
        @keyframes slideUp {
            from { transform: translateY(20px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }
        .animate-up { animation: slideUp 0.5s ease forwards; }
        
        /* Hide scrollbar */
        ::-webkit-scrollbar { width: 0; }
    </style>
</head>
<body class="p-4 md:p-8">

    <div id="auth-section" class="max-w-md mx-auto mt-4 md:mt-10">
        <div class="glass-card p-8 rounded-[2.5rem] shadow-2xl animate-up">
            <div class="text-center mb-10">
                <div class="w-20 h-20 bg-green-600 rounded-3xl flex items-center justify-center mx-auto mb-4 shadow-xl shadow-green-200">
                    <i class="fa-solid fa-store text-white text-4xl"></i>
                </div>
                <h1 class="text-3xl font-extrabold text-green-800 tracking-tighter">RYD STORE</h1>
                <p class="text-[10px] text-green-500 font-bold uppercase tracking-[0.3em] mt-1">Sistem Keamanan Prioritas</p>
            </div>

            <div class="space-y-4">
                <div class="relative">
                    <i class="fa-solid fa-user absolute left-4 top-4 text-green-300"></i>
                    <input type="text" id="user-input" placeholder="Buat Username" class="w-full pl-12 p-4 border-2 border-green-50 rounded-2xl outline-none focus:border-green-500 bg-green-50/30 font-semibold">
                </div>
                <div class="relative">
                    <i class="fa-solid fa-lock absolute left-4 top-4 text-green-300"></i>
                    <input type="password" id="pass-input" placeholder="Buat Password" class="w-full pl-12 p-4 border-2 border-green-50 rounded-2xl outline-none focus:border-green-500 bg-green-50/30 font-semibold">
                </div>

                <div id="referral-box" class="hidden animate-up">
                    <div class="relative">
                        <i class="fa-solid fa-share-nodes absolute left-4 top-4 text-emerald-400"></i>
                        <input type="text" id="ref-input" placeholder="ID Teman Pengajak (Opsional)" class="w-full pl-12 p-4 border-2 border-emerald-100 rounded-2xl outline-none bg-emerald-50/20 font-semibold">
                    </div>
                    <div class="mt-4 p-4 bg-yellow-50 rounded-2xl border-2 border-dashed border-yellow-300">
                        <p class="text-[10px] text-yellow-700 font-extrabold text-center uppercase leading-tight">
                            ðŸ“¸ PENTING! HARAP SCREENSHOT<br>SETELAH MENGEKLIK DAFTAR
                        </p>
                    </div>
                </div>

                <button onclick="prosesAuth()" id="btn-submit" class="w-full btn-green p-5 rounded-2xl font-extrabold shadow-lg shadow-green-100 uppercase tracking-widest mt-2">
                    Masuk Sekarang
                </button>

                <div class="text-center mt-6">
                    <p class="text-sm font-semibold text-slate-400">
                        <span id="auth-label">Belum bergabung?</span>
                        <button onclick="gantiMode()" id="mode-toggle" class="text-green-600 font-extrabold ml-1 uppercase text-xs underline decoration-2 underline-offset-4">Daftar Akun</button>
                    </p>
                </div>
            </div>
        </div>
    </div>

    <div id="main-app" class="max-w-md mx-auto hidden animate-up">
        
        <div class="glass-card p-6 rounded-[2.5rem] mb-6 shadow-xl border-b-[6px] border-green-600 relative overflow-hidden">
            <div class="relative z-10">
                <div class="flex items-center gap-2 mb-4">
                    <div class="w-8 h-8 bg-green-100 rounded-full flex items-center justify-center">
                        <i class="fa-solid fa-user-check text-green-600 text-xs"></i>
                    </div>
                    <span class="text-xs font-extrabold text-slate-500 uppercase tracking-widest">Halo, <span id="user-id-display" class="text-green-600">User</span></span>
                </div>
                <p class="text-[10px] text-slate-400 font-bold uppercase tracking-[0.2em]">Saldo Tersedia</p>
                <h2 class="text-4xl font-extrabold text-slate-800 tracking-tighter">Rp <span id="balance-display">0</span></h2>
            </div>
            <button onclick="keluar()" class="absolute top-6 right-6 w-12 h-12 bg-red-50 text-red-500 rounded-2xl flex items-center justify-center hover:bg-red-500 hover:text-white transition-all">
                <i class="fa-solid fa-power-off text-lg"></i>
            </button>
            <div class="absolute -bottom-4 -right-4 w-24 h-24 bg-green-50 rounded-full opacity-50"></div>
        </div>

        <div class="grid grid-cols-2 gap-4 mb-8">
            <button onclick="keWADeposit()" class="bg-white p-5 rounded-[2rem] shadow-md flex flex-col items-center gap-3 border-2 border-green-50 hover:border-green-200 transition-all">
                <div class="w-12 h-12 bg-green-600 text-white rounded-2xl flex items-center justify-center shadow-lg shadow-green-100">
                    <i class="fa-solid fa-wallet text-xl"></i>
                </div>
                <span class="font-extrabold text-[10px] text-slate-600 uppercase tracking-widest">Isi Saldo</span>
            </button>
            <button onclick="bukaTransfer()" class="bg-white p-5 rounded-[2rem] shadow-md flex flex-col items-center gap-3 border-2 border-emerald-50 hover:border-emerald-200 transition-all">
                <div class="w-12 h-12 bg-emerald-500 text-white rounded-2xl flex items-center justify-center shadow-lg shadow-emerald-100">
                    <i class="fa-solid fa-paper-plane text-xl"></i>
                </div>
                <span class="font-extrabold text-[10px] text-slate-600 uppercase tracking-widest">Kirim Saldo</span>
            </button>
        </div>

        <div class="flex items-center justify-between mb-4 px-2">
            <h3 class="text-green-800 font-extrabold text-xs uppercase tracking-widest">ðŸ’Ž Katalog Produk</h3>
            <span class="text-[10px] font-bold text-slate-400 bg-white px-3 py-1 rounded-full border border-slate-100">Proses Manual</span>
        </div>

        <div class="grid grid-cols-2 gap-3" id="catalog-container">
            </div>

        <div class="mt-8 glass-card p-7 rounded-[2.5rem] border-2 border-dashed border-green-200 text-center relative">
            <div class="absolute -top-3 left-1/2 -translate-x-1/2 bg-green-600 text-white px-4 py-1 rounded-full text-[9px] font-black uppercase tracking-widest">Cuan Gratis</div>
            <h4 class="font-extrabold text-slate-800 text-sm uppercase mb-2">Program Referral</h4>
            <p class="text-[10px] text-slate-500 font-semibold mb-5 leading-relaxed">Dapatkan bonus saldo Rp 5.000 setiap kali temanmu mendaftar menggunakan ID kamu!</p>
            <button onclick="bagikanLink()" class="w-full btn-green py-4 rounded-2xl font-extrabold text-[11px] uppercase tracking-widest shadow-xl shadow-green-100">
                <i class="fa-solid fa-share-nodes mr-2"></i> Bagikan Link Toko
            </button>
        </div>

        <footer class="mt-10 text-center">
            <p class="text-[9px] text-slate-400 font-extrabold uppercase tracking-widest">RYD STORE &copy; 2026</p>
        </footer>
    </div>

    <script>
        // 1. FIREBASE SETUP
        const fbConfig = { databaseURL: "https://riyadistore3-default-rtdb.firebaseio.com/" };
        firebase.initializeApp(fbConfig);
        const db = firebase.database();

        let sessionUser = null;
        let regMode = false;

        // 2. DATA PRODUK (KEUNTUNGAN DISESUAIKAN)
        const products = [
            { id: 1, title: "Royal Dream 1B", price: 66500, cat: "Chips", icon: "fa-gem", col: "text-purple-600" },
            { id: 2, title: "Royal Dream 2B", price: 132000, cat: "Chips", icon: "fa-gem", col: "text-purple-600" },
            { id: 3, title: "Royal Dream 5B", price: 325000, cat: "Chips", icon: "fa-gem", col: "text-purple-600" },
            { id: 4, title: "Pulsa 5.000", price: 7000, cat: "Pulsa", icon: "fa-mobile-screen", col: "text-green-500" },
            { id: 5, title: "Pulsa 10.000", price: 12500, cat: "Pulsa", icon: "fa-mobile-screen", col: "text-green-500" },
            { id: 6, title: "Pulsa 20.000", price: 21500, cat: "Pulsa", icon: "fa-mobile-screen", col: "text-green-500" },
            { id: 7, title: "Pulsa 50.000", price: 51500, cat: "Pulsa", icon: "fa-mobile-screen", col: "text-green-500" },
            { id: 8, title: "Pulsa 100.000", price: 101500, cat: "Pulsa", icon: "fa-mobile-screen", col: "text-green-500" },
            { id: 9, title: "E-Wallet 100k", price: 101500, cat: "Wallet", icon: "fa-wallet", col: "text-emerald-500" },
            { id: 10, title: "Saldo RYD 500k", price: 501500, cat: "Akun", icon: "fa-coins", col: "text-green-700" },
            { id: 11, title: "Saldo RYD 1 Juta", price: 1001500, cat: "Akun", icon: "fa-crown", col: "text-green-800" }
        ];

        // 3. FUNGSI AUTH (LOGIN & DAFTAR)
        function gantiMode() {
            regMode = !regMode;
            document.getElementById('referral-box').classList.toggle('hidden');
            document.getElementById('auth-label').innerText = regMode ? 'Sudah punya akun?' : 'Belum bergabung?';
            document.getElementById('mode-toggle').innerText = regMode ? 'Masuk' : 'Daftar Akun';
            document.getElementById('btn-submit').innerText = regMode ? 'Daftar & Screenshot' : 'Masuk Sekarang';
        }

        async function prosesAuth() {
            const user = document.getElementById('user-input').value.toLowerCase().trim();
            const pass = document.getElementById('pass-input').value;
            const ref = document.getElementById('ref-input').value.trim();

            if (!user || !pass) return Swal.fire('Error', 'Username & Password wajib diisi!', 'error');
            if (user.length < 3) return Swal.fire('Gagal', 'Username terlalu pendek!', 'warning');

            const refUser = db.ref('users/' + user);
            const snap = await refUser.once('value');

            if (regMode) {
                if (snap.exists()) return Swal.fire('Username Terpakai', 'Gunakan nama lain!', 'warning');
                
                // Simpan User Baru
                await refUser.set({
                    username: user, password: pass, saldo: 0,
                    upline: ref || "Owner", created: new Date().getTime()
                });

                // NOTIFIKASI SCREENSHOT (PENTING)
                await Swal.fire({
                    title: 'DAFTAR BERHASIL!',
                    html: `<div style="text-align:left; background:#fffde7; padding:20px; border-radius:20px; border:3px dashed #fbc02d; font-size:14px">
                            <p style="color:red; font-weight:900; text-align:center; margin-bottom:12px">ðŸ“¸ HARAP SCREENSHOT SEKARANG!</p>
                            <hr style="border:1px solid #fff176">
                            <p style="margin-top:10px"><b>ID USER:</b> ${user}</p>
                            <p><b>PASSWORD:</b> ${pass}</p>
                            <p style="font-size:10px; color:gray; margin-top:15px"><i>*Gunakan data ini untuk masuk ke aplikasi.</i></p>
                           </div>`,
                    icon: 'success',
                    confirmButtonText: 'SAYA SUDAH SIMPAN',
                    confirmButtonColor: '#16a34a'
                });
                location.reload();
            } else {
                const data = snap.val();
                if (data && data.password === pass) {
                    mulaiAplikasi(data);
                } else {
                    Swal.fire('Gagal Masuk', 'Username atau Password salah!', 'error');
                }
            }
        }

        // 4. LOGIKA UTAMA APLIKASI
        function mulaiAplikasi(data) {
            sessionUser = data.username;
            document.getElementById('auth-section').classList.add('hidden');
            document.getElementById('main-app').classList.remove('hidden');
            document.getElementById('user-id-display').innerText = sessionUser;
            
            tampilkanKatalog();

            // Pantau Saldo Secara Realtime (Keamanan Data)
            db.ref('users/' + sessionUser + '/saldo').on('value', (s) => {
                const val = s.val() || 0;
                document.getElementById('balance-display').innerText = val.toLocaleString('id-ID');
            });
        }

        function tampilkanKatalog() {
            const container = document.getElementById('catalog-container');
            container.innerHTML = products.map(p => `
                <div onclick="beliProduk('${p.title}', ${p.price})" class="product-item p-5 rounded-[2rem] shadow-sm flex flex-col items-center text-center cursor-pointer">
                    <div class="w-10 h-10 bg-slate-50 rounded-xl flex items-center justify-center mb-3">
                        <i class="fa-solid ${p.icon} ${p.col} text-lg"></i>
                    </div>
                    <p class="font-extrabold text-[10px] text-slate-400 uppercase tracking-tighter mb-1">${p.title}</p>
                    <p class="text-green-600 font-extrabold text-xs">Rp ${p.price.toLocaleString('id-ID')}</p>
                </div>
            `).join('');
        }

        // 5. FITUR KEAMANAN TRANSAKSI
        async function beliProduk(nama, harga) {
            // Cek saldo terbaru dari database (Bukan dari tampilan)
            const snap = await db.ref('users/' + sessionUser).once('value');
            const dataUser = snap.val();
            const saldoAktual = dataUser.saldo;

            if (saldoAktual < harga) {
                return Swal.fire({
                    title: 'SALDO TIDAK CUKUP',
                    text: `Anda butuh Rp ${harga.toLocaleString()}, saldo saat ini Rp ${saldoAktual.toLocaleString()}.`,
                    icon: 'error',
                    confirmButtonText: 'Top Up Sekarang',
                    confirmButtonColor: '#16a34a'
                }).then((r) => { if(r.isConfirmed) keWADeposit(); });
            }

            // Verifikasi Password Setiap Transaksi
            const { value: passInput } = await Swal.fire({
                title: 'Konfirmasi Keamanan',
                text: `Beli ${nama}? Masukkan password akun Anda:`,
                input: 'password',
                inputPlaceholder: 'Password Anda',
                showCancelButton: true,
                confirmButtonColor: '#16a34a'
            });

            if (passInput === dataUser.password) {
                // Kurangi Saldo di Database
                const saldoBaru = saldoAktual - harga;
                await db.ref('users/' + sessionUser).update({ saldo: saldoBaru });

                // Redirect ke WhatsApp Admin
                const pesan = `Halo Admin RYD STORE, Saya *${sessionUser.toUpperCase()}* ingin membeli *${nama}*.\nSaldo saya sudah terpotong otomatis sebesar Rp ${harga.toLocaleString()}.\nMohon segera diproses!`;
                
                Swal.fire('Berhasil!', 'Saldo terpotong. Menghubungi Admin...', 'success');
                setTimeout(() => {
                    window.location.href = `https://wa.me/6281283303643?text=${encodeURIComponent(pesan)}`;
                }, 1500);
            } else if (passInput) {
                Swal.fire('Password Salah!', 'Transaksi dibatalkan demi keamanan.', 'error');
            }
        }

        // 6. FITUR TRANSFER SALDO LENGKAP
        async function bukaTransfer() {
            const { value: formValues } = await Swal.fire({
                title: 'Transfer Saldo',
                html:
                    '<input id="tf-target" class="swal2-input" placeholder="ID Penerima">' +
                    '<input id="tf-amount" type="number" class="swal2-input" placeholder="Jumlah (Min 1.000)">',
                focusConfirm: false,
                confirmButtonColor: '#059669',
                confirmButtonText: 'Lanjutkan',
                preConfirm: () => {
                    return [
                        document.getElementById('tf-target').value.toLowerCase().trim(),
                        parseInt(document.getElementById('tf-amount').value)
                    ]
                }
            });

            if (formValues) {
                const [target, jumlah] = formValues;
                if (!target || isNaN(jumlah) || jumlah < 1000) return Swal.fire('Gagal', 'Input tidak valid atau minimal transfer Rp 1.000', 'warning');
                if (target === sessionUser) return Swal.fire('Error', 'Tidak bisa kirim ke diri sendiri!', 'warning');

                const senderSnap = await db.ref('users/' + sessionUser).once('value');
                const targetSnap = await db.ref('users/' + target).once('value');

                if (senderSnap.val().saldo < jumlah) return Swal.fire('Gagal', 'Saldo Anda tidak cukup!', 'error');
                if (!targetSnap.exists()) return Swal.fire('Gagal', 'Penerima tidak ditemukan!', 'error');

                const { value: passKirim } = await Swal.fire({
                    title: 'Validasi Terakhir',
                    text: `Kirim Rp ${jumlah.toLocaleString()} ke ${target}? Masukkan password Anda:`,
                    input: 'password',
                    confirmButtonColor: '#059669'
                });

                if (passKirim === senderSnap.val().password) {
                    // Eksekusi Transfer
                    await db.ref('users/' + sessionUser).update({ saldo: senderSnap.val().saldo - jumlah });
                    await db.ref('users/' + target).update({ saldo: (targetSnap.val().saldo || 0) + jumlah });
                    
                    Swal.fire('Transfer Sukses!', `Saldo terkirim ke ${target}`, 'success');
                } else if (passKirim) {
                    Swal.fire('Gagal', 'Password salah!', 'error');
                }
            }
        }

        // 7. FITUR LAINNYA
        function bagikanLink() {
            const link = window.location.href;
            const text = `ðŸš€ Top Up Game Aman & Murah di RYD STORE!\n\nKlik Link: ${link}\nMasukkan kode referral: *${sessionUser}* saat daftar.`;
            window.location.href = `https://wa.me/?text=${encodeURIComponent(text)}`;
        }

        function keWADeposit() {
            window.location.href = "https://wa.me/6281283303643?text=Halo%20Admin%2C%20saya%20mau%20isi%20saldo%20RYD%20STORE";
        }

        function keluar() {
            location.reload();
        }
    </script>
</body>
</html>
