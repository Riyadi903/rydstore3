<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>RYD STORE OFFICIAL</title>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;700;900&display=swap');
        body { font-family: 'Inter', sans-serif; background-color: #f3f4f6; }
        .blue-gradient { background: linear-gradient(135deg, #1e40af 0%, #3b82f6 100%); }
        .btn-active:active { transform: scale(0.95); }
    </style>
</head>
<body>

<div id="app" class="max-w-md mx-auto min-h-screen bg-white shadow-2xl relative flex flex-col">
    </div>

<script>
    // --- KONFIGURASI ---
    const WA_ADMIN = "6285881934739";
    const UNTUNG = 1500;
    const firebaseConfig = {
        apiKey: "AIzaSyAgv7_Ysh6_Pz0q7VvF_Ew8A0p-6pM46eE",
        databaseURL: "https://rydstore3-default-rtdb.asia-southeast1.firebasedatabase.app",
        projectId: "rydstore3"
    };

    // Inisialisasi
    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();
    let userAktif = localStorage.getItem('ryd_user');

    const providers = [
        { name: 'Telkomsel', logo: 'üî¥' }, { name: 'Indosat', logo: 'üü°' },
        { name: 'XL Axiata', logo: 'üîµ' }, { name: 'Axis', logo: 'üü£' },
        { name: 'Three', logo: '‚ö´' }, { name: 'Smartfren', logo: 'üíó' }
    ];

    function load(html) { document.getElementById('app').innerHTML = html; }

    // --- HALAMAN LOGIN ---
    function showLogin() {
        load(`
            <div class="p-10 pt-20 text-center flex-1">
                <div class="w-20 h-20 blue-gradient rounded-3xl mx-auto mb-6 flex items-center justify-center text-white text-4xl font-black shadow-lg">R</div>
                <h1 class="text-3xl font-black text-gray-800 tracking-tighter mb-10 uppercase">RYD STORE</h1>
                <div class="space-y-4">
                    <input id="u" type="text" placeholder="Username" class="w-full p-4 bg-gray-50 border rounded-2xl outline-none focus:border-blue-500">
                    <input id="p" type="password" placeholder="Password" class="w-full p-4 bg-gray-50 border rounded-2xl outline-none focus:border-blue-500">
                    <button onclick="handleLogin()" class="w-full blue-gradient text-white p-4 rounded-2xl font-black btn-active shadow-lg">MASUK</button>
                    <button onclick="showRegister()" class="w-full text-blue-600 font-bold text-sm">Daftar Akun Baru</button>
                </div>
            </div>
        `);
    }

    function showRegister() {
        load(`
            <div class="p-10 pt-20 flex-1">
                <h2 class="text-2xl font-black text-gray-800 mb-8 uppercase">Daftar Akun</h2>
                <div class="space-y-4">
                    <input id="ru" type="text" placeholder="Buat Username" class="w-full p-4 bg-gray-50 border rounded-2xl outline-none">
                    <input id="rp" type="password" placeholder="Buat Password" class="w-full p-4 bg-gray-50 border rounded-2xl outline-none">
                    <button onclick="handleRegister()" class="w-full bg-green-600 text-white p-4 rounded-2xl font-black btn-active">DAFTAR SEKARANG</button>
                    <button onclick="showLogin()" class="w-full text-gray-400 font-bold text-sm">Kembali</button>
                </div>
            </div>
        `);
    }

    // --- HALAMAN DASHBOARD ---
    function showDashboard() {
        db.ref('users/' + userAktif).on('value', (s) => {
            const data = s.val();
            if(!data) return;
            load(`
                <div class="blue-gradient p-6 pb-20 rounded-b-[40px] text-white shadow-lg">
                    <div class="flex justify-between items-center mb-10">
                        <div><p class="text-[10px] font-bold opacity-60 uppercase">Selamat Datang,</p><h2 class="text-xl font-black uppercase tracking-tighter">${userAktif}</h2></div>
                        <button onclick="logout()" class="bg-white/20 p-2 px-4 rounded-xl text-[10px] font-bold border border-white/20">KELUAR</button>
                    </div>
                    <div class="bg-white/10 p-6 rounded-3xl border border-white/10 shadow-inner">
                        <p class="text-[10px] font-bold opacity-80 uppercase mb-1">Saldo Anda</p>
                        <h2 class="text-3xl font-black tracking-tighter">Rp ${Number(data.saldo || 0).toLocaleString('id-ID')}</h2>
                    </div>
                </div>

                <div class="px-5 -mt-10 flex-1">
                    <div class="bg-white p-4 rounded-3xl shadow-xl flex justify-around mb-8 border border-gray-50">
                        <button onclick="showTransfer()" class="flex flex-col items-center btn-active">
                            <div class="w-14 h-14 bg-blue-50 rounded-2xl flex items-center justify-center text-blue-600 mb-1 text-xl font-black italic shadow-inner">TF</div>
                            <span class="text-[10px] font-bold text-gray-400 uppercase">Transfer</span>
                        </button>
                        <button onclick="kirimWA('Halo Admin, saya mau ISI SALDO user: ${userAktif}')" class="flex flex-col items-center btn-active">
                            <div class="w-14 h-14 bg-orange-50 rounded-2xl flex items-center justify-center text-orange-600 mb-1 text-2xl font-black shadow-inner">+</div>
                            <span class="text-[10px] font-bold text-gray-400 uppercase">Top Up</span>
                        </button>
                    </div>

                    <h3 class="font-black text-gray-800 mb-4 px-2 text-xs uppercase tracking-widest text-center">Pilih Provider</h3>
                    <div class="grid grid-cols-3 gap-3 pb-10">
                        ${providers.map(p => `
                            <div onclick="showProduct('${p.name}')" class="bg-gray-50 p-4 rounded-3xl flex flex-col items-center btn-active border border-white shadow-sm">
                                <span class="text-2xl mb-1">${p.logo}</span>
                                <span class="font-black text-gray-700 text-[8px] uppercase">${p.name}</span>
                            </div>
                        `).join('')}
                    </div>
                </div>
            `);
        });
    }

    function showProduct(provider) {
        const nominals = [5000, 10000, 20000, 50000, 100000];
        let list = `<div class="p-6 flex-1">
            <div class="flex items-center mb-8"><button onclick="showDashboard()" class="text-2xl mr-4 text-blue-600">‚Üê</button><h2 class="text-xl font-black text-gray-800 uppercase italic">PULSA ${provider}</h2></div>
            <div class="bg-blue-50 p-6 rounded-3xl mb-6 border border-blue-100">
                <input id="no_hp" type="number" placeholder="Nomor HP Tujuan" class="w-full bg-transparent text-xl font-black text-center outline-none">
            </div>`;
        nominals.forEach(n => {
            const harga = n + UNTUNG;
            list += `
                <div onclick="doOrder('${provider}', ${n}, ${harga})" class="flex justify-between p-5 bg-gray-50 border border-gray-100 rounded-3xl items-center btn-active mb-3">
                    <p class="text-xl font-black text-gray-800 tracking-tighter">${n/1000}K</p>
                    <p class="font-black text-blue-600">Rp ${harga.toLocaleString()}</p>
                </div>`;
        });
        load(list + `</div>`);
    }

    function showTransfer() {
        load(`
            <div class="p-6 flex-1">
                <div class="flex items-center mb-8"><button onclick="showDashboard()" class="text-2xl mr-4 text-blue-600 font-bold">‚Üê</button><h2 class="text-xl font-black text-gray-800 uppercase italic">Transfer Saldo</h2></div>
                <div class="space-y-4">
                    <input id="t_user" type="text" placeholder="Username Penerima" class="w-full p-5 bg-gray-50 border rounded-3xl outline-none font-bold">
                    <input id="t_amount" type="number" placeholder="Nominal Transfer" class="w-full p-5 bg-gray-50 border rounded-3xl outline-none font-bold">
                    <button onclick="doTransfer()" class="w-full blue-gradient text-white p-5 rounded-3xl font-black shadow-lg btn-active uppercase">Kirim Saldo</button>
                </div>
            </div>
        `);
    }

    // --- LOGIKA ---
    function handleLogin() {
        const u = document.getElementById('u').value.toLowerCase().trim();
        const p = document.getElementById('p').value;
        db.ref('users/' + u).once('value', (s) => {
            if(s.exists() && s.val().password === p) {
                userAktif = u; localStorage.setItem('ryd_user', u); showDashboard();
            } else { alert("Gagal Login!"); }
        });
    }

    function handleRegister() {
        const u = document.getElementById('ru').value.toLowerCase().trim();
        const p = document.getElementById('rp').value;
        if(u.length < 3) return alert("Username minimal 3 huruf!");
        db.ref('users/' + u).set({ password: p, saldo: 0 }).then(() => { alert("Sukses!"); showLogin(); });
    }

    function doOrder(prov, nom, hrg) {
        const no = document.getElementById('no_hp').value;
        if(no.length < 10) return alert("Nomor HP salah!");
        db.ref('users/' + userAktif).once('value', (s) => {
            const saldo = s.val().saldo || 0;
            if(saldo < hrg) return alert("Saldo tidak cukup!");
            db.ref('users/' + userAktif).update({ saldo: saldo - hrg });
            kirimWA(`PESANAN BARU\nProduk: ${prov} ${nom}\nTujuan: ${no}\nUser: ${userAktif}\nSisa Saldo: ${saldo - hrg}`);
        });
    }

    function doTransfer() {
        const target = document.getElementById('t_user').value.toLowerCase().trim();
        const amount = parseInt(document.getElementById('t_amount').value);
        if(target === userAktif || !amount) return alert("Data salah!");
        db.ref('users/' + userAktif).once('value', (my) => {
            const mySaldo = my.val().saldo || 0;
            if(mySaldo < amount) return alert("Saldo kurang!");
            db.ref('users/' + target).once('value', (tg) => {
                if(!tg.exists()) return alert("User tidak ada!");
                db.ref('users/' + userAktif).update({ saldo: mySaldo - amount });
                db.ref('users/' + target).update({ saldo: (tg.val().saldo || 0) + amount });
                alert("Berhasil!"); showDashboard();
            });
        });
    }

    function kirimWA(msg) { window.location.href = `https://wa.me/${WA_ADMIN}?text=${encodeURIComponent(msg)}`; }
    function logout() { localStorage.removeItem('ryd_user'); location.reload(); }

    if(userAktif) showDashboard(); else showLogin();
</script>
</body>
</html>
