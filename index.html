<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>RYD STORE OFFICIAL</title>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;800&display=swap');
        body { font-family: 'Inter', sans-serif; background-color: #1a2233; color: white; -webkit-tap-highlight-color: transparent; }
        .bg-card { background-color: #252f44; border: 1px solid #333f58; }
        .btn-primary { background-color: #3b82f6; transition: 0.2s; }
        .input-style { background-color: #252f44; border: 1px solid #333f58; color: white; border-radius: 12px; }
        .icon-circle { width: 50px; height: 50px; border-radius: 14px; display: flex; align-items: center; justify-content: center; margin-bottom: 8px; font-weight: bold; font-size: 10px; color: white; }
    </style>
</head>
<body>

<div id="app" class="max-w-md mx-auto min-h-screen shadow-2xl flex flex-col relative overflow-hidden">
    <div class="p-20 text-center animate-pulse text-white">Menghubungkan Database...</div>
</div>

<div id="modalProduk" class="fixed inset-0 bg-black/70 z-50 flex items-end hidden" onclick="tutupModal()">
    <div class="bg-white w-full p-8 rounded-t-[30px] text-slate-900" onclick="event.stopPropagation()">
        <div class="w-12 h-1.5 bg-gray-200 rounded-full mx-auto mb-6"></div>
        <h3 id="modalTitle" class="text-xl font-black mb-6 italic text-blue-600 uppercase">Pilih Nominal</h3>
        <div id="listProduk" class="grid grid-cols-2 gap-4 max-h-[60vh] overflow-y-auto pb-10"></div>
    </div>
</div>

<script>
    // --- KONFIGURASI FIREBASE ---
    const WA_ADMIN = "6285881934739";
    const PROFIT = 2000;
    const firebaseConfig = {
        apiKey: "AIzaSyCEeF0D3RB5uthkMKx5rkSTEYii-7Pp0KM",
        authDomain: "riyadistore3.firebaseapp.com",
        databaseURL: "https://riyadistore3-default-rtdb.asia-southeast1.firebasedatabase.app",
        projectId: "riyadistore3",
        storageBucket: "riyadistore3.firebasestorage.app",
        messagingSenderId: "28764528472",
        appId: "1:28764528472:web:941e615ef35d62b4724f2d"
    };

    if (!firebase.apps.length) firebase.initializeApp(firebaseConfig);
    const db = firebase.database();
    let userAktif = localStorage.getItem('ryd_user');

    function view(html) { document.getElementById('app').innerHTML = html; }

    function pageLogin() {
        view(`
            <div class="p-8 pt-20 flex-1">
                <div class="w-24 h-24 bg-blue-600 rounded-[2.5rem] mx-auto mb-6 flex items-center justify-center font-black text-5xl italic shadow-2xl">R</div>
                <h1 class="text-2xl font-bold text-center mb-1">RYD STORE OFFICIAL</h1>
                <p class="text-center text-gray-500 text-[10px] mb-12 uppercase tracking-widest italic font-bold">Digital Payment System</p>
                <div class="space-y-4">
                    <input id="l_u" type="text" placeholder="Username" class="input-style w-full p-4 outline-none">
                    <input id="l_p" type="password" placeholder="Password" class="input-style w-full p-4 outline-none">
                    <button onclick="doLogin()" class="w-full btn-primary p-4 rounded-xl font-bold mt-4 shadow-lg">MASUK</button>
                    <button onclick="pageRegister()" class="w-full text-gray-500 font-bold text-xs mt-4 uppercase text-center block">Daftar Member</button>
                </div>
            </div>
        `);
    }

    function pageRegister() {
        view(`
            <div class="p-8 pt-20">
                <h2 class="text-4xl font-black mb-8 italic tracking-tighter uppercase text-blue-500">Daftar Akun</h2>
                <div class="space-y-4">
                    <input id="r_u" type="text" placeholder="Username Baru" class="input-style w-full p-4 outline-none">
                    <input id="r_p" type="password" placeholder="Password Baru" class="input-style w-full p-4 outline-none">
                    <button onclick="doRegister()" class="w-full btn-primary p-4 rounded-xl font-bold shadow-lg">KONFIRMASI DAFTAR</button>
                    <button onclick="pageLogin()" class="w-full text-gray-500 font-bold text-xs mt-4 uppercase text-center block">Kembali ke Login</button>
                </div>
            </div>
        `);
    }

    function pageDashboard() {
        const path = 'users/' + userAktif.toLowerCase();
        
        db.ref(path).on('value', (snapshot) => {
            const data = snapshot.val();
            if(!data) {
                logout();
                return;
            }

            // --- PERBAIKAN PEMBACAAN SALDO ---
            // Mengambil saldo dan memastikan nilainya angka
            let saldoRaw = data.saldo;
            let saldoFinal = 0;
            if (saldoRaw) {
                // Menghapus titik atau koma jika admin salah input sebagai teks
                if(typeof saldoRaw === 'string') {
                    saldoFinal = parseInt(saldoRaw.replace(/[^0-9]/g, '')) || 0;
                } else {
                    saldoFinal = saldoRaw;
                }
            }

            view(`
                <div class="p-6">
                    <div class="flex justify-between items-center mb-10">
                        <div>
                            <p class="text-[9px] text-gray-500 uppercase font-black tracking-widest mb-1">User Aktif :</p>
                            <h2 class="text-xl font-black uppercase italic tracking-tighter text-blue-400">@${userAktif}</h2>
                        </div>
                        <button onclick="logout()" class="bg-red-500/10 text-red-500 p-2 px-4 rounded-lg text-[10px] font-bold">LOGOUT</button>
                    </div>

                    <div class="bg-gradient-to-br from-blue-600 to-blue-900 p-8 rounded-[2.5rem] shadow-2xl mb-10 border border-white/10">
                        <p class="text-[10px] font-bold opacity-60 uppercase tracking-widest mb-1">Saldo Anda</p>
                        <h2 class="text-4xl font-black italic tracking-tighter">Rp ${saldoFinal.toLocaleString('id-ID')}</h2>
                    </div>

                    <div class="bg-white rounded-[2.5rem] p-8 text-gray-800 shadow-xl">
                        <p class="font-black mb-6 uppercase text-[10px] tracking-widest text-gray-400 border-b pb-2">Menu Produk</p>
                        <div class="grid grid-cols-4 gap-4 mb-8">
                            <div onclick="bukaModal('Telkomsel', 'pulsa')" class="flex flex-col items-center"><div class="icon-circle bg-red-600">T-SEL</div><span class="text-[9px] font-bold">T-Sel</span></div>
                            <div onclick="bukaModal('Indosat', 'pulsa')" class="flex flex-col items-center"><div class="icon-circle bg-yellow-500 text-black">ISAT</div><span class="text-[9px] font-bold">Indosat</span></div>
                            <div onclick="bukaModal('XL', 'pulsa')" class="flex flex-col items-center"><div class="icon-circle bg-blue-700">XL</div><span class="text-[9px] font-bold">XL</span></div>
                            <div onclick="bukaModal('Tri', 'pulsa')" class="flex flex-col items-center"><div class="icon-circle bg-pink-600">TRI</div><span class="text-[9px] font-bold">Tri</span></div>
                        </div>
                        <div class="grid grid-cols-4 gap-4">
                            <div onclick="bukaModal('DANA', 'ewallet')" class="flex flex-col items-center"><div class="icon-circle bg-blue-500 italic">DANA</div><span class="text-[9px] font-bold">DANA</span></div>
                            <div onclick="bukaModal('GoPay', 'ewallet')" class="flex flex-col items-center"><div class="icon-circle bg-emerald-600 italic">GOPAY</div><span class="text-[9px] font-bold">GoPay</span></div>
                            <div onclick="bukaModal('OVO', 'ewallet')" class="flex flex-col items-center"><div class="icon-circle bg-purple-700 italic">OVO</div><span class="text-[9px] font-bold">OVO</span></div>
                            <div onclick="bukaModal('Free Fire', 'game')" class="flex flex-col items-center"><div class="icon-circle bg-orange-600 italic">FF</div><span class="text-[9px] font-bold">FF</span></div>
                        </div>
                    </div>
                    
                    <button onclick="window.location.href='https://wa.me/${WA_ADMIN}?text=Isi Saldo @${userAktif.toUpperCase()}'" class="w-full bg-blue-500 mt-8 p-4 rounded-2xl font-black italic uppercase tracking-tighter text-sm shadow-xl shadow-blue-500/30">Isi Saldo Lewat WA</button>
                    
                    ${userAktif.toLowerCase() === 'admin' ? '<button onclick="adminPanel()" class="w-full border border-blue-500 text-blue-500 mt-4 p-4 rounded-2xl font-bold uppercase text-xs">Admin Panel</button>' : ''}
                </div>
            `);
        });
    }

    // --- FITUR ADMIN PANEL ---
    function adminPanel() {
        const target = prompt("Masukkan Username yang mau diisi saldonya:");
        if(!target) return;
        const jumlah = prompt("Masukkan Jumlah Saldo (angka saja):");
        if(!jumlah) return;
        
        db.ref('users/' + target.toLowerCase()).update({
            saldo: parseInt(jumlah)
        }).then(() => alert("Berhasil Update Saldo " + target));
    }

    function bukaModal(name, tipe) {
        document.getElementById('modalTitle').innerText = name;
        const list = document.getElementById('listProduk');
        list.innerHTML = "";
        let nominals = [5000, 10000, 20000, 50000, 100000];
        if(tipe === 'game') nominals = [70, 140, 355];

        nominals.forEach(nom => {
            const harga = nom + PROFIT;
            list.innerHTML += `
                <div onclick="beli('${name}', '${nom}', ${harga})" class="bg-gray-100 p-5 rounded-2xl border border-gray-100 active:bg-gray-300 text-center">
                    <p class="text-[8px] font-black text-gray-400 uppercase tracking-widest">${tipe}</p>
                    <p class="text-xl font-black text-slate-800 italic">${nom.toLocaleString()}</p>
                    <p class="text-[10px] font-black text-blue-600 mt-1 border-t pt-1 italic uppercase">Rp ${harga.toLocaleString('id-ID')}</p>
                </div>
            `;
        });
        document.getElementById('modalProduk').classList.remove('hidden');
    }

    function tutupModal() { document.getElementById('modalProduk').classList.add('hidden'); }

    function beli(p, n, h) {
        const pesan = `*ORDER RYD STORE*%0AðŸ‘¤ User: *${userAktif.toUpperCase()}*%0AðŸ“¦ Item: *${p}*%0AðŸ’Ž Nom: *${n.toLocaleString()}*%0AðŸ’° Bayar: *Rp ${h.toLocaleString('id-ID')}*%0A_Mohon diproses Admin._`;
        window.location.href = `https://wa.me/${WA_ADMIN}?text=${pesan}`;
    }

    function doLogin() {
        const u = document.getElementById('l_u').value.toLowerCase().trim();
        const p = document.getElementById('l_p').value;
        if(!u || !p) return alert("Isi Username & Password!");
        db.ref('users/' + u).once('value', s => {
            if(s.exists() && s.val().password === p) {
                userAktif = u; localStorage.setItem('ryd_user', u); pageDashboard();
            } else { alert("Data Salah!"); }
        });
    }

    function doRegister() {
        const u = document.getElementById('r_u').value.toLowerCase().trim();
        const p = document.getElementById('r_p').value;
        if(u.length < 3) return alert("Minimal 3 Huruf!");
        db.ref('users/' + u).set({ password: p, saldo: 0 }).then(() => {
            alert("Pendaftaran Berhasil!"); pageLogin();
        });
    }

    function logout() { localStorage.removeItem('ryd_user'); location.reload(); }

    if(userAktif) pageDashboard(); else pageLogin();
</script>
</body>
</html>
