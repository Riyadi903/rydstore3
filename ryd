<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>RYD STORE - Payment & Balance</title>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>
    <style>
        :root { --primary: #007bff; --success: #28a745; --bg: #f4f7f9; }
        body { font-family: 'Segoe UI', sans-serif; background: var(--bg); margin: 0; padding: 0; }
        .container { max-width: 450px; margin: auto; padding: 15px; }
        .card { background: white; padding: 15px; border-radius: 12px; box-shadow: 0 2px 8px rgba(0,0,0,0.05); margin-bottom: 15px; }
        .page { display: none; }
        .active { display: block; }
        input { width: 100%; padding: 12px; margin: 8px 0; border: 1px solid #ddd; border-radius: 8px; box-sizing: border-box; }
        button { width: 100%; padding: 12px; border: none; border-radius: 8px; font-weight: bold; cursor: pointer; margin-top: 10px; }
        .btn-blue { background: var(--primary); color: white; }
        .btn-outline { background: transparent; border: 1px solid var(--primary); color: var(--primary); }
        .header-blue { background: linear-gradient(135deg, #007bff, #00c6ff); color: white; padding: 20px; border-radius: 15px; text-align: center; }
        .balance { font-size: 32px; font-weight: bold; margin: 5px 0; }
        .operator-title { font-weight: bold; margin: 15px 0 5px; display: block; color: #555; font-size: 14px; background: #e9ecef; padding: 5px 10px; border-radius: 5px; }
        .grid-price { display: grid; grid-template-columns: 1fr 1fr; gap: 8px; }
        .price-box { border: 1px solid #eee; padding: 10px; border-radius: 10px; text-align: center; background: #fff; cursor: pointer; }
        .price-box:active { background: #e7f3ff; }
        .p-name { font-size: 11px; color: #777; display: block; }
        .p-val { font-size: 15px; font-weight: bold; color: var(--success); }
        .method-list { display: flex; justify-content: space-around; gap: 10px; margin-top: 10px; }
        .method-btn { flex: 1; border: 1px solid #ddd; padding: 10px; border-radius: 10px; text-align: center; font-size: 12px; }
    </style>
</head>
<body>

    <div class="container">
        <div id="loading" style="text-align:center; margin-top:100px;">Menghubungkan ke server RYD STORE...</div>

        <div id="loginPage" class="page">
            <div class="card" style="margin-top: 50px; text-align: center;">
                <h1 style="color:var(--primary)">RYD STORE</h1>
                <p>Silakan Masuk ke Akun Anda</p>
                <input type="text" id="logUser" placeholder="Username">
                <input type="password" id="logPass" placeholder="Password">
                <button class="btn-blue" onclick="handleLogin()">MASUK</button>
                <button class="btn-outline" onclick="showPage('registerPage')">BELUM PUNYA AKUN? DAFTAR</button>
            </div>
        </div>

        <div id="registerPage" class="page">
            <div class="card">
                <h3>Daftar Member Baru</h3>
                <input type="text" id="regUser" placeholder="Buat Username">
                <input type="password" id="regPass" placeholder="Buat Password">
                <button class="btn-blue" onclick="handleRegister()">DAFTAR SEKARANG</button>
                <button class="btn-outline" onclick="showPage('loginPage')">KEMBALI KE LOGIN</button>
            </div>
        </div>

        <div id="mainPage" class="page">
            <div class="header-blue">
                <span id="displayName">Memuat Nama...</span>
                <div class="balance" id="displaySaldo">Rp 0</div>
                <div style="font-size: 11px;">Status: Member RYD STORE</div>
            </div>

            <p style="text-align: center; font-weight: bold; margin: 15px 0 5px;">PRODUK PULSA</p>
            <div id="productArea"></div>

            <div class="card" style="margin-top: 20px;">
                <h3 style="font-size: 14px; margin-bottom: 10px;">METODE TOP UP SALDO</h3>
                <div class="method-list">
                    <div class="method-btn" onclick="topup('DANA')">üí∞<br>DANA</div>
                    <div class="method-btn" onclick="topup('QRIS')">üñºÔ∏è<br>QRIS</div>
                    <div class="method-btn" onclick="topup('GOPAY')">üõµ<br>GOPAY</div>
                </div>
            </div>
            <button class="btn-outline" onclick="logout()" style="color:red; border-color:red; margin-bottom: 30px;">LOGOUT / KELUAR</button>
        </div>
    </div>

    <script>
        // CONFIGURASI FIREBASE BERDASARKAN DATA KAMU
        const firebaseConfig = {
            apiKey: "AIzaSyAnknIfrCMpKjDwTKrKIs169bHHPTsTrWs",
            authDomain: "riyadistore3.firebaseapp.com",
            databaseURL: "https://riyadistore3-default-rtdb.asia-southeast1.firebasedatabase.app",
            projectId: "riyadistore3",
            storageBucket: "riyadistore3.firebasestorage.app",
            messagingSenderId: "28764528472",
            appId: "1:28764528472:web:1cb7ac6e22709e97724f2d",
            measurementId: "G-T612RTF3N7"
        };

        // Inisialisasi Firebase
        firebase.initializeApp(firebaseConfig);
        const db = firebase.database();
        const WA_ADMIN = "628XXXXXXXXXX"; // <--- GANTI JADI NOMOR WHATSAPP KAMU

        let currentUser = null;

        function showPage(id) {
            document.getElementById('loading').style.display = 'none';
            document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
            document.getElementById(id).classList.add('active');
        }

        function initProducts() {
            const ops = ["TELKOMSEL", "INDOSAT", "XL/AXIS", "TRI"];
            const noms = [5, 10, 20, 50, 100];
            let html = '';
            ops.forEach(op => {
                html += `<span class="operator-title">${op}</span><div class="grid-price">`;
                noms.forEach(n => {
                    let harga = (n * 1000) + 1500;
                    html += `<div class="price-box" onclick="beli('${op}', '${n}rb')">
                                <span class="p-name">${op} ${n}rb</span>
                                <span class="p-val">Rp ${harga.toLocaleString()}</span>
                             </div>`;
                });
                html += `</div>`;
            });
            document.getElementById('productArea').innerHTML = html;
        }

        function handleRegister() {
            const u = document.getElementById('regUser').value.toLowerCase().trim();
            const p = document.getElementById('regPass').value;
            if(!u || !p) return alert("Isi Username dan Password!");

            db.ref('users/' + u).once('value', (snapshot) => {
                if (snapshot.exists()) {
                    alert("Username sudah terdaftar! Gunakan nama lain.");
                } else {
                    db.ref('users/' + u).set({
                        password: p,
                        saldo: 0,
                        username: u
                    }).then(() => {
                        alert("Pendaftaran Berhasil! Silakan Login.");
                        showPage('loginPage');
                    });
                }
            });
        }

        function handleLogin() {
            const u = document.getElementById('logUser').value.toLowerCase().trim();
            const p = document.getElementById('logPass').value;

            db.ref('users/' + u).once('value', (snapshot) => {
                const data = snapshot.val();
                if(data && data.password === p) {
                    currentUser = u;
                    localStorage.setItem('ryd_session', u);
                    loadDashboard(data);
                } else {
                    alert("Username atau Password salah!");
                }
            });
        }

        function loadDashboard(data) {
            document.getElementById('displayName').innerText = "Halo, " + data.username.toUpperCase();
            document.getElementById('displaySaldo').innerText = "Rp " + data.saldo.toLocaleString();
            initProducts();
            showPage('mainPage');
            
            // Pantau Saldo secara Realtime
            db.ref('users/' + currentUser + '/saldo').on('value', (snap) => {
                if(snap.val() !== null) {
                    document.getElementById('displaySaldo').innerText = "Rp " + snap.val().toLocaleString();
                }
            });
        }

        function topup(m) {
            let n = prompt("Masukkan Nominal Top Up (Contoh: 50000):");
            if(n) {
                let msg = encodeURIComponent(`Halo Admin, saya mau TOP UP SALDO\nMetode: ${m}\nNominal: Rp ${n}\nUsername: ${currentUser}`);
                window.location.href = `https://api.whatsapp.com/send?phone=${WA_ADMIN}&text=${msg}`;
            }
        }

        function beli(op, pr) {
            let confirmBuy = confirm(`Konfirmasi Pembelian ${op} ${pr}?`);
            if(confirmBuy) {
                let msg = encodeURIComponent(`Halo Admin, saya mau beli produk:\nOperator: ${op}\nProduk: ${pr}\nUsername: ${currentUser}`);
                window.location.href = `https://api.whatsapp.com/send?phone=${WA_ADMIN}&text=${msg}`;
            }
        }

        function logout() {
            localStorage.removeItem('ryd_session');
            location.reload();
        }

        window.onload = function() {
            let session = localStorage.getItem('ryd_session');
            if(session) {
                db.ref('users/' + session).once('value', (snap) => {
                    if(snap.exists()) {
                        currentUser = session;
                        loadDashboard(snap.val());
                    } else { showPage('loginPage'); }
                });
            } else {
                showPage('loginPage');
            }
        }
    </script>
</body>
</html>
